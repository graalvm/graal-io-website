<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/gdk/resources/img/graalvm.png" />
  <meta name="twitter:widgets:border-color" content="#55acee">

  <title>
    
      Create and Deploy a Micronaut Gateway Function as an Amazon Lambda Function
    
  </title>
  <meta name="description" content="The Graal Development Kit for Micronaut (GDK) is a build of a curated set of Micronaut framework modules and their required libraries for building portable c..."/>
  <meta name="last_modified" content="2024-09-25 16:23:51 +0000"/>
  <meta name="last_built" content="2024-10-15 16:35:11 +0000"/>
  <link rel="stylesheet" href="/gdk/assets/main.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/gdk/resources/img/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/gdk/resources/img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/gdk/resources/img/favicon/favicon-16x16.png">
  <link rel="manifest" href="/gdk/resources/img/favicon/site.webmanifest">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="-vRqwa9WYn6AaQGnl88xvrLw6ac4xoKVkZkhanmlRhU" />
  <link rel="canonical" href="https://www.graal.cloud/gdk/gdk-modules/serverless/micronaut-function-aws/">

  <!-- jQuery UI Tabs -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/gdk/resources/lib/jquery/jquery-ui.css">
</head>

      <script src="/gdk/resources/lib/jquery/jquery-3.7.1.min.js"></script>
    <script src="/gdk/resources/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src='/gdk/resources/lib/sticky-sidebar/resizeSensor.js'></script>
    <script src='/gdk/resources/lib/sticky-sidebar/sticky-sidebar.min.js'></script>
    <script src="/gdk/resources/lib/highlight/highlight.min.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Add TRUSTe Consent Script and Analytics -->
    <script async="async" type="text/javascript" src='//consent.trustarc.com/notice?domain=oracle.com&c=teconsent&js=bb&noticeType=bb&text=true&cdn=1&pcookie&gtm=1' crossorigin></script>
    <script src="https://www.oracle.com/assets/truste-oraclelib.js"></script>
    <!-- jQuery UI Tabs -->
    <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>


  <body class="preload">
    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <div  class="wrapper wrapper--nofooter" >

      <header  class="header header--content" 
  role="banner">

  

  

    <nav class="menu">
      <div class="menu__row">
        <div>
          <a href="/gdk/">
            <img class="logo-mobile" src="/gdk/resources/img/gdk-logo-new.svg" alt="Graal Development Kit for Micronaut logo">
          </a>
        </div>
        <div class="menu__container">
          <ul class="menu__list">
            <li class="menu__item">
              <a href="/gdk/about/" class="menu__link">About</a>
            </li>
            <li class="menu__item">
              <a href="/gdk/get-started/" class="menu__link">Get Started</a>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Docs</a>
                <div class="stack-menu-learn">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/modules.svg'>
                        <a href="/gdk/modules/" class="item-line">Modules</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/guides.svg'>
                        <a href="/gdk/guides/" class="item-line">Guides</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/labs.svg'>
                        <a href="/gdk/hands-on-labs/" class="item-line">Hands-On Labs</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/tools.svg'>
                        <a href="/gdk/vscode-tools/" class="item-line">Tools</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Graal Projects</a>
                <div class="stack-menu">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalstack.svg'>
                        <a href="https://graal.cloud/" class="item-line">Graal</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalvm.svg'>
                        <a href="https://graalvm.org/" class="item-line">GraalVM</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalos.svg'>
                        <a href="https://graal.cloud/graalos/" class="item-line">GraalOS</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__launch__mobile">
              <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
            </li>
          </ul>
        </div>
        <div class="menu__launch">
          <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
        </div>
      </div>

      <div role="button" class="menu-btn menu-btn--menu js-show-menu" tabindex="-1" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
      <button aria-label="hamburger mobile menu" class="btn btn-mobile-menu js-show-menu">
        <div class="inner"></div>
      </button>
    </nav>

  
</header>


      <main  class="content"   aria-label="Content">
        <div class="wrapper wrapper-content">
  <article>
  <div class="row d-flex flex-wrap">
    <div class="col-sm-3 docsimpro col-bg">
      <div class="sidebar-wrap">
        <div class="sidebar">
          <div class="menuabout">
            <img id="sidebarClose" src="/gdk/resources/img/arrow_sidebar(close).svg" alt="Expand or collapse sidebar"
              class="btn-color no-display">
            <img id="sidebarOpen" src="/gdk/resources/img/arrow_sidebar.svg" alt="Expand or collapse sidebar">
          </div>
          
<div class="toc-floating">


<div class="toc-bullets">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    

    
      
        
          <li class="toc-bullets-main">
        
          
          <a href="/gdk/docs/gdk-modules/serverless/" class="_icon-book">
            Serverless
          </a>
        </li>

        
        

        
        
          
          <li class="toc-bullets-sub toc-bullets-highlight">
          
            
            <a href="/gdk/gdk-modules/serverless/micronaut-function-aws/">
              Create and Deploy a Micronaut Gateway Function as an Amazon Lambda Function
            </a>
          </li>

          
            <div>
  <script>
    var scriptElement = document.currentScript;
    var div = $(scriptElement.parentElement);
    $(window).on("load", function () {
      $("#content-wrapper h2").each(function () {
        var li = $("<li></li>", { class: "toc-bullets-sub toc-bullets-sub-3" });
        var a = $("<a></a>", { href: "#" + $(this).attr("id") });
        a.text($(this).text().replace('#', ''));
        li.append(a);
        li.click(function (e) {
          e.preventDefault();
          var target = $(a.attr('href'));
          var scrollTo = target.offset().top - 80; // 80 - indent
          $('html, body').animate({ scrollTop: scrollTo }, 1000);
        });
        div.append(li);
      });
    });
  </script>
</div>
          
        
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

<!-- <li class="search additional-search">
  <form class="form-inline sidebar" action="/docs/search" autocomplete="on" method="get">
    <input class="input-search sidebar" type="text" id="search-box" name="query" placeholder="Search">
    <button type="submit sidebar" class="search-button"></button>
  </form>
</li> -->

</div>
  <!-- Search form -->
  <!-- <form class="search-container" action="/docs/search" autocomplete="on" method="get">
   <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <button type="submit" class="searchbttn"></button>
  </form> -->
</div>

        </div>
      </div>
    </div>

    <div class="col-sm-9 docsmod">
      <div id="content-wrapper" class="docs-content docs-content--with-sidebar">
        <!--
          Include file to warn of Windows/Gradle restriction
        -->
        <h1 id="create-and-deploy-a-micronaut-gateway-function-as-an-amazon-lambda-function">
        
        
          Create and Deploy a Micronaut Gateway Function as an Amazon Lambda Function
        
        
      </h1>

<p>This guide describes how to use the Graal Development Kit for Micronaut (GDK) to create a Micronaut<sup>®</sup> Gateway function, deploy it using <a href="https://aws.amazon.com/lambda/">Amazon Lambda</a>, and access it via <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a>. The application is compiled into a native executable using GraalVM Native Image and then built into a container image.</p>

<blockquote>
  <p>A Micronaut Gateway Function acts a a serverless cloud (HTTP) API gateway function.</p>
</blockquote>

<blockquote>
  <p>Amazon Lambda is a serverless, event-driven compute service that lets you run code for virtually any type of application or back-end service without provisioning or managing servers. You can deploy code to AWS Lambda function by uploading a ZIP file, or by creating and uploading a container image. AWS provides several open source base images that you can use to build the container image for your function code.</p>
</blockquote>
    
      <h3 id="prerequisites">
        
        
          Prerequisites <a href="#prerequisites" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li>JDK 17 or higher. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>.</li>
  <li>An Amazon Web Services (AWS) account. See <a href="/gdk/get-started/setting-up-cloud-accounts/">Setting up Your Cloud Accounts</a>.</li>
  <li>A Docker-API compatible container runtime such as <a href="https://docs.rancherdesktop.io/getting-started/installation/">Rancher Desktop</a> or <a href="https://www.docker.io/gettingstarted/">Docker</a> installed and running.</li>
  <li>The GDK CLI. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>. (Optional.)</li>
</ul>

<p>Follow the steps below to create a Micronaut gateway function from scratch. However, you can also download the completed example:</p>

<div id="tabs-doc1">
  <ul>
    <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <p><a href="https://github.com/oracle/graal-dev-kit/releases/download/4.6.0.3/4.6.0.3_serverless_aws-serverless-demo-java-gradle.zip">Gradle AWS Serverless Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
  <div id="maven">
    <p><a href="https://github.com/oracle/graal-dev-kit/releases/download/4.6.0.3/4.6.0.3_serverless_aws-serverless-demo-java-maven.zip">Maven AWS Serverless Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
</div>
    
      <h4 id="a-note-regarding-your-development-environment">
        
        
          A note regarding your development environment
        
        
      </h4>

<p>Consider using Visual Studio Code, which provides native support for developing applications with the <a href="/gdk/vscode-tools/using-gdk-vscode-tools/">Graal Development Kit extension</a>.</p>

<p>If you use IntelliJ IDEA, <a href="/gdk/resources/img/annotationprocessorsintellij.png">enable annotation processing</a>.</p>

<blockquote>
  <p>Windows platform: The GDK guides are compatible with Gradle only. Maven support is coming soon.</p>
</blockquote>
    
      <h2 id="1-create-the-gateway-function">
        
        
          1. Create the Gateway Function <a href="#1-create-the-gateway-function" class="anchor_heading">#</a>
        
        
      </h2>

<p>This section describes how to create a Micronaut gateway function for a simple online store. The store provides information about available items and enables the user to order items. An HTTP controller is responsible for the API implementation and a service stores the availability of items.</p>

<p>Create a Micronaut gateway function using the GDK Launcher.</p>

<ol>
  <li>
    <p>Open the <a href="/gdk/launcher/?advanced=true">GDK Launcher in advanced mode</a>.</p>
  </li>
  <li>Create a new project using the following selections.
    <ul>
      <li><strong>Project Type</strong>: <em>Gateway Function</em></li>
      <li><strong>Project Name</strong>: <em>aws-serverless-demo</em></li>
      <li><strong>Base Package</strong>: <em>com.example</em> (Default)</li>
      <li><strong>Clouds</strong>: <em>AWS</em></li>
      <li><strong>Build Tool</strong>: <em>Gradle (Groovy)</em> or <em>Maven</em></li>
      <li><strong>Language</strong>: <em>Java</em> (Default)</li>
      <li><strong>Test Framework</strong>: <em>JUnit</em> (Default)</li>
      <li><strong>Java Version</strong>: <em>17</em> (Default)</li>
      <li><strong>Micronaut Version</strong>: (Default)</li>
      <li><strong>Cloud Services</strong>: <em>None</em></li>
      <li><strong>Features</strong>: <em>GraalVM Native Image</em> and <em>Micronaut Validation</em></li>
      <li><strong>Sample Code</strong>: <em>No</em></li>
    </ul>
  </li>
  <li>Click <strong>Generate Project</strong>, then click <strong>Download Zip</strong>. The GDK Launcher creates a Micronaut gateway function with the default package <code>com.example</code> in a directory named <em>aws-serverless-demo</em>. The application ZIP file will be downloaded to your default downloads directory. Unzip it, open it in your code editor, and proceed to the next steps.</li>
</ol>

<p>Alternatively, use the GDK CLI as follows:</p>

<div id="tabs-doc2">
  <ul>
    <li class="tabs-gradle"><a href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <pre><code class="language-bash">gdk create-gateway-function com.example.aws-serverless-demo \
    --clouds=aws \
    --features=graalvm,validation \
    --example-code=false \
    --jdk=17 \
    --build=gradle \
    --lang=java</code></pre>
  </div>
  <div id="maven">
    <pre><code class="language-bash">gdk create-gateway-function com.example.aws-serverless-demo \
    --clouds=aws \
    --features=graalvm,validation \
    --example-code=false \
    --jdk=17 \
    --build=maven \
    --lang=java</code></pre>
  </div>
</div>

<p>For more information, see <a href="/gdk/get-started/using-gdk-cli/">Using the GDK CLI</a>.</p>

<p>The GDK Launcher creates a multi-module project with two subprojects: <strong>aws</strong> for Amazon Web Services, and <strong>lib</strong>.
You develop the gateway function logic in the <strong>aws</strong> subproject. If your gateway function is to be deployed to multiple cloud providers, use the <strong>lib</strong> subproject to create classes that can be shared between the providers. This enables you to separate the code that is different between cloud providers, while keeping most of the implementation in the common <strong>lib</strong> subproject.</p>
    
      <h3 id="11-storeitem">
        
        
          1.1. StoreItem <a href="#11-storeitem" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create a <code>StoreItem</code> model to represent an item in the store in the file <em>lib/src/main/java/com/example/StoreItem.java</em> with the following contents:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.core.annotation.Introspected;
import io.micronaut.core.annotation.NonNull;

import io.micronaut.serde.annotation.Serdeable;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotBlank;

@Serdeable
@Introspected // &lt;1&gt;
public class StoreItem {

    @NotBlank
    @NonNull
    private final String name;

    private final String description;

    @Min(0)
    private int numberInStorage;

    public StoreItem(String name, String description, int numberInStorage) { // &lt;2&gt;
        this.name = name;
        this.description = description;
        this.numberInStorage = numberInStorage;
    }

    public String getName() {
        return name;
    }

    public String getDescription() {
        return description;
    }

    public Integer getNumberInStorage() {
        return numberInStorage;
    }

    public void setNumberInStorage(Integer numberInStorage) {
        this.numberInStorage = numberInStorage;
    }
}
</code></pre>

<p><strong>1</strong> The <a href="https://micronaut-projects.github.io/micronaut-core/latest/api/io/micronaut/core/annotation/Introspected.html"><code>@Introspected</code></a> annotation enables Micronaut to serialize and deserialize the model from different formats including <code>JSON</code>. This provides the ability to use the type inside HTTP requests or responses.</p>

<p><strong>2</strong> The model has fields to store the item’s name, description, and number available.</p>
    
      <h3 id="12-storecontroller">
        
        
          1.2. StoreController <a href="#12-storecontroller" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create an HTTP controller in the file <em>lib/src/main/java/com/example/StoreController.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.PathVariable;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.exceptions.HttpStatusException;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;

import java.util.Collection;
import java.util.stream.Collectors;

import static io.micronaut.http.HttpStatus.BAD_REQUEST;
import static io.micronaut.http.HttpStatus.NOT_FOUND;

@Controller("/store") // &lt;1&gt;
class StoreController {

    private final StorageService storageService;

    StoreController(StorageService storageService) { // &lt;2&gt;
        this.storageService = storageService;
    }

    @Get("/all") // &lt;3&gt;
    Collection&lt;StoreItem&gt; listAllItems() {
        return storageService.getItems();
    }

    @Get("/available") // &lt;4&gt;
    Collection&lt;StoreItem&gt; listAvailableItems() {
        return storageService.getItems().stream()
                .filter(i -&gt; i.getNumberInStorage() &gt; 0)
                .collect(Collectors.toList());
    }

    @Post(uri = "/order/{name}/{amount}", consumes = "*/*") // &lt;5&gt;
    HttpResponse&lt;StoreItem&gt; orderItem(@NotBlank @PathVariable String name, @Min(1) int amount) {
        if (storageService.findItem(name).isEmpty()) {
            throw new HttpStatusException(NOT_FOUND, "Item '" + name + "' not found");
        }
        try {
            storageService.orderItem(name, amount);
        } catch (StorageService.StorageException e) {
            throw new HttpStatusException(BAD_REQUEST, "Could not order item '" + name + "'. " + e.getMessage());
        }
        return HttpResponse.ok(storageService.findItem(name).orElse(null));
    }
}
</code></pre>

<p><strong>1</strong> The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html"><code>@Controller</code></a> annotation mapped to the path <code>/store</code>.</p>

<p><strong>2</strong> Use <a href="https://docs.micronaut.io/latest/guide/#qualifiers">Micronaut argument injection</a> to inject a <code>StorageService</code> bean by defining it as the constructor argument. You will create the <code>StorageService</code> in next section.</p>

<p><strong>3</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html"><code>@Get</code></a> annotation maps the <code>listAllItems</code> method to an HTTP GET request on <code>/store/all</code>.</p>

<p><strong>4</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html"><code>@Get</code></a> annotation maps the <code>listAvailableItems</code> method to an HTTP GET request on <code>/store/available</code>.</p>

<p><strong>5</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Post.html"><code>@Post</code></a> annotation maps the <code>orderItem</code> method to an HTTP POST request on <code>/store/order/{name}/{amount}</code>. Use the <code>consumes</code> argument to specify which content-types are allowed in the request. Throwing <code>HttpStatusException</code> will set the corresponding HTTP status in the response.</p>
    
      <h3 id="13-storageservice">
        
        
          1.3. StorageService <a href="#13-storageservice" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>Create an interface for a service that represents the store’s inventory in <em>lib/src/main/java/com/example/StorageService.java</em>:</p>

    <pre><code class="language-java"> package com.example;

 import io.micronaut.core.annotation.NonNull;

 import jakarta.validation.constraints.Min;
 import jakarta.validation.constraints.NotBlank;
 import java.util.Collection;
 import java.util.Optional;

 public interface StorageService { // &lt;1&gt;
     Collection&lt;StoreItem&gt; getItems();
     Optional&lt;StoreItem&gt; findItem(@NonNull @NotBlank String name);
     void orderItem(@NonNull @NotBlank String name, @Min(1) int amount);

     class StorageException extends RuntimeException { // &lt;2&gt;
         StorageException(String message) {
             super(message);
         }
     }
 }
</code></pre>

    <p><strong>1</strong> The storage service provides information about all the items, finds an items by its name, and can place an order for an item.</p>

    <p><strong>2</strong> The class includes a custom exception that thrown in case of invalid requests to storage.</p>
  </li>
  <li>
    <p>Create an implementation of the service interface in <em>lib/src/main/java/com/example/DefaultStorageService.java</em>:</p>

    <pre><code class="language-java"> package com.example;

 import io.micronaut.context.annotation.Requires;
 import io.micronaut.core.annotation.NonNull;
 import jakarta.inject.Singleton;

 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.List;
 import java.util.Optional;

 @Singleton // &lt;1&gt;
 @Requires(missingBeans = StorageService.class) // &lt;2&gt;
 class DefaultStorageService implements StorageService {

     protected List&lt;StoreItem&gt; items = List.of( // &lt;3&gt;
         new StoreItem("chair", "A black chair with 4 legs", 10),
         new StoreItem("table", "A quality dining table", 6),
         new StoreItem("sofa", "A gray sofa", 2),
         new StoreItem("bookshelf", "A futuristic-looking bookshelf", 0)
     );

     @Override
     public Collection&lt;StoreItem&gt; getItems() {
         return items;
     }

     @Override
     public Optional&lt;StoreItem&gt; findItem(@NonNull String name) {
         return items.stream().filter(item -&gt; item.getName().equals(name)).findFirst();
     }

     @Override
     public void orderItem(@NonNull String name, int amount) {
         findItem(name).ifPresentOrElse(item -&gt; {
             if (item.getNumberInStorage() &gt;= amount) {
                 item.setNumberInStorage(item.getNumberInStorage() - amount);
             } else {
                 throw new StorageException("Insufficient amount in storage");
             }
         }, () -&gt; { throw new StorageException("Item not found in storage"); });
     }
 }
</code></pre>

    <p><strong>1</strong> Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</p>

    <p><strong>2</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/Requires.html"><code>@Requires(missingBeans = StorageService.class)</code></a> annotation specifies that this implementation should only be used if no other implementations could be found.</p>

    <p><strong>3</strong> The implementation stores the items in a <code>List</code> and populates some sample items in the list.</p>
  </li>
</ol>

<p>If you wish to implement a more advanced <code>StorageService</code> to be used instead of this one, annotate your implementation with <code>@Singleton</code> as shown above. Use the <code>@Requires(env = "ec2")</code> annotation to make it specific to AWS . Visit the <a href="/gdk/modules/#database">Database Module</a> for details about how to store and manipulate data in a database.</p>
    
      <h3 id="14-tests-to-verify-gateway-function-logic">
        
        
          1.4. Tests to Verify Gateway Function Logic <a href="#14-tests-to-verify-gateway-function-logic" class="anchor_heading">#</a>
        
        
      </h3>

<p>The GDK Launcher created a test class for the controller in <em>aws/src/test/java/com/example/StoreControllerTest.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.context.annotation.Property;
import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.http.client.exceptions.HttpClientResponseException;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import jakarta.inject.Singleton;
import org.junit.jupiter.api.Test;

import java.util.ArrayList;
import java.util.List;

import static io.micronaut.http.HttpStatus.BAD_REQUEST;
import static io.micronaut.http.HttpStatus.NOT_FOUND;
import static io.micronaut.http.HttpStatus.OK;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;

@MicronautTest // &lt;1&gt;
@Property(name = "use-test-storage-service", value = "true")
class StoreControllerTest {

    @Inject
    StoreClient client;

    @Test
    void testAvailableItems() {
        List&lt;StoreItem&gt; availableItems = client.getAvailable();

        assertEquals(2, availableItems.size());
        assertEquals("pot", availableItems.get(1).getName());
        assertEquals(10, availableItems.get(1).getNumberInStorage());
        assertNotNull(availableItems.get(1).getDescription());
    }

    @Test
    void testNotFoundException() {
        HttpResponse&lt;?&gt; response = client.order("lamp", 1);

        assertEquals(NOT_FOUND, response.getStatus());
    }

    @Test
    void testNotSufficientException() {
        HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt; {
            client.order("pot", 100);
        });

        assertEquals(BAD_REQUEST, e.getStatus());
    }

    @Test
    void testOrderRequest() {
        StoreItem plate = client.getAll().stream()
                .filter(i -&gt; i.getName().equals("plate"))
                .findFirst().orElse(null);
        assertNotNull(plate);
        assertEquals(100, plate.getNumberInStorage());

        HttpResponse&lt;StoreItem&gt; response = client.order("plate", 10);
        assertEquals(OK, response.getStatus());
        assertNotNull(response.body());
        assertEquals("plate", response.body().getName());
        assertEquals(90, response.body().getNumberInStorage());
    }

    @Singleton
    @Requires(property = "use-test-storage-service", value = "true")
    static class TestStorageService extends DefaultStorageService {
        TestStorageService() { // &lt;2&gt;
            items = List.of(
                    new StoreItem("plate", "A large plate", 100),
                    new StoreItem("pot", "A cooking pot", 10),
                    new StoreItem("pan", "A large pan", 0)
            );
        }
    }

    @Client("/store") // &lt;3&gt;
    interface StoreClient {
        @Get("/all") // &lt;4&gt;
        List&lt;StoreItem&gt; getAll();

        @Get("/available") // &lt;4&gt;
        List&lt;StoreItem&gt; getAvailable();

        @Post("/order/{name}/{amount}") // &lt;4&gt;
        HttpResponse&lt;StoreItem&gt; order(String name, Integer amount);
    }
}
</code></pre>
<p><strong>1</strong> Annotate the class with <a href="https://micronaut-projects.github.io/micronaut-test/latest/api/io/micronaut/test/annotation/MicronautTest.html"><code>@MicronautTest</code></a> so the Micronaut framework will initialize the application context. This enables you to inject beans using the Jakarta <code>@Inject</code> annotation and to send requests to the <code>StoreController</code> defined in the application. Configure this test to use an identified context using the <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/Property.html"><code>@Property(name = "use-test-storage-service", value = "true")</code></a> annotation.</p>

<p><strong>2</strong> Create a mock implementation of <code>StorageService</code> so that the test is independent of the current state of the storage. The <code>@Requires(property = "use-test-storage-service", value = "true")</code> means that the bean should only be available if the specified property is set.</p>

<p><strong>3</strong> Create a <a href="https://docs.micronaut.io/latest/guide/#clientAnnotation">Micronaut Declarative Client</a> with the same <code>/store</code> path to send requests to the controller.</p>

<p><strong>4</strong> Create three tests using the defined client and assuming that <code>TestStorageService</code> is used.</p>
    
      <h2 id="2-run-the-tests">
        
        
          2. Run the Tests <a href="#2-run-the-tests" class="anchor_heading">#</a>
        
        
      </h2>

<p>Run the tests using the following command:</p>

<div id="tabs-doc3">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">
        <pre><code class="language-bash">./gradlew test</code></pre>
        <p>Then open the file <em>ec2/build/reports/tests/test/index.html</em> in a browser to view the results.</p>
    </div>
    <div id="maven">
        <pre><code class="language-bash">./mvnw test</code></pre>
    </div>
</div>

<p>Although you created this gateway function to run on the Amazon Lambda Function runtime, the tests should run successfully on your local machine.</p>

<p>Furthermore, Micronaut has a test implementation that simulates the Lambda environment. Since sequential requests to a function may be processed by different instances, Micronaut creates a separate environment for each request in test.</p>
    
      <h2 id="3-create-an-amazon-lambda-function">
        
        
          3. Create an Amazon Lambda Function <a href="#3-create-an-amazon-lambda-function" class="anchor_heading">#</a>
        
        
      </h2>

<p>The Micronaut framework makes it easier to deploy a function to a <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html">Custom AWS Lambda runtime</a>.</p>
    
      <h3 id="31-generate-a-native-executable-using-graalvm">
        
        
          3.1. Generate a Native Executable Using GraalVM <a href="#31-generate-a-native-executable-using-graalvm" class="anchor_heading">#</a>
        
        
      </h3>

<p>The GDK supports compiling Java applications ahead-of-time into native executables using <a href="https://www.graalvm.org/" target="_blank">GraalVM Native Image</a>.
You can use the <em><a href="https://graalvm.github.io/native-build-tools/latest/gradle-plugin.html" target="_blank">Gradle plugin for GraalVM Native Image building</a></em>/<em><a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html" target="_blank">Maven plugin for GraalVM Native Image building</a></em>.
Packaged as a native executable, it significantly reduces application startup time and memory footprint.</p>

<blockquote>
  <p><strong>Prerequisites</strong>: Make sure you have installed a GraalVM JDK. The easiest way to get started is with <a href="https://sdkman.io/jdks#graal">SDKMAN!</a>. For other installation options, visit the <a href="https://www.graalvm.org/downloads/">Downloads section</a>.</p>
</blockquote>

<p>The following command generates a ZIP file which contains a native executable of the application, generated with GraalVM Native Image, and a bootstrap file which runs that native executable. The native executable of the application is generated inside a container.</p>

<div id="tabs-doc4">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">
        <p>
            Run the command:
            <pre class="margin-snip-zero"><code class="language-bash">./gradlew aws:buildNativeLambda</code></pre>
        </p>
          <blockquote><p>
            Note (<b>Only on macOS AArch64</b>): add the following line to the <code>dependencies</code> block of the <em>buildSrc/build.gradle</em> configuration file:
            <pre class="margin-snip-zero"><code>implementation("com.github.docker-java:docker-java-transport-httpclient5:3.3.1")</code></pre>
        </p></blockquote>
    </div>
    <div id="maven">
        <p>
            Modify the <em>aws/pom.xml</em> file to set the following property:
            <pre><code class="language-xml">&lt;properties&gt;
    ...
    &lt;exec.mainClass&gt;io.micronaut.function.aws.runtime.MicronautLambdaRuntime&lt;/exec.mainClass&gt;
    ...
&lt;/properties&gt;</code></pre>
        </p>
        <p>
            Run the commands:
            <pre><code class="language-bash">./mvnw install -pl lib -am
./mvnw package -Dpackaging=docker-native -Pgraalvm -pl aws</code></pre>
        </p>
    </div>
</div>
    
      <h3 id="32-create-a-lambda-function">
        
        
          3.2. Create a Lambda Function <a href="#32-create-a-lambda-function" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>Sign in to the AWS Console. Go to <a href="https://console.aws.amazon.com/lambda/home">Amazon Lambda Functions</a>. Click <strong>Create function</strong>.</p>
  </li>
  <li>Select <strong>Author from scratch</strong>, and provide the following information, then click <strong>Create function</strong>:
    <ul>
      <li>Enter “gdk-serverless-demo-native” for the name of the function.</li>
      <li>For the runtime, select <strong>Amazon Linux 2023</strong> from the drop-down list.</li>
      <li>Select <strong>x86_64</strong> as the architecture.</li>
    </ul>
  </li>
  <li>
    <p>Scroll down, in the <strong>Code</strong> tab, click <strong>Upload from</strong>, and select <strong>.zip file</strong> from the drop-down list.</p>

    <p>Choose the archive you created in the previous section (a container image) from the following location (read the logs from generation command if the file is not present):</p>
    <div id="tabs-doc5">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">
        <p><em>aws/build/libs/aws-1.0-SNAPSHOT-lambda.zip</em></p>
    </div>
    <div id="maven">
        <p><em>aws/target/function.zip</em></p>
    </div>
</div>
    <p>Click <strong>Save</strong>.</p>
  </li>
  <li>Scroll down within the <strong>Code</strong> tab. In the <strong>Runtime settings</strong> section, click <strong>Edit</strong>.
As Handler, enter <code>io.micronaut.function.aws.proxy.MicronautLambdaHandler</code>. Click <strong>Save</strong>.</li>
</ol>
    
      <h3 id="33-test-the-lambda-function">
        
        
          3.3. Test the Lambda Function <a href="#33-test-the-lambda-function" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>In the Lambda Function, click the <strong>Test</strong> tab.
Enter a name for the new test (such as “test”) and paste the following event in the <strong>Event JSON</strong> field:
    <pre><code class="language-json">{
  "path": "/store/all",
  "httpMethod": "GET",
  "headers": {
    "Accept": "application/json"
  }
}
</code></pre>
    <p>Click <strong>Save</strong> to save the test. Click <strong>Test</strong> to run it.</p>
  </li>
  <li>Scroll up. Inside the <strong>Execution Result</strong> block verify that the response body is as expected.</li>
</ol>
    
      <h2 id="4-create-an-aws-api-gateway">
        
        
          4. Create an AWS API Gateway <a href="#4-create-an-aws-api-gateway" class="anchor_heading">#</a>
        
        
      </h2>

<p>This section describes how to create an API Gateway to provide access to the function.</p>

<ol>
  <li>
    <p>Go to <a href="https://console.aws.amazon.com/apigateway/main/apis">API Gateway</a> in the AWS Console. Scroll down to <strong>REST API</strong>. Click <strong>Build</strong>.</p>
  </li>
  <li>
    <p>Select <strong>New API</strong>.
Enter a name for the new API and select <strong>Regional</strong> from the drop-down list for “API endpoint type”. Click <strong>Create API</strong>.</p>
  </li>
  <li>
    <p>Once created, click <strong>Create resource</strong>.
Enter a name for the resource, and enter “/” as the Resource Path and “{proxy+}” as the Resource Name to allow all paths.
Click <strong>Create Resource</strong>.</p>
  </li>
  <li>Select the “/{proxy+}” resource and click <strong>Create method</strong>.
Enter the following information, and then click <strong>Save</strong>.
If a dialog box appears, click <strong>OK</strong> to give the gateway permission to run the function. Click <strong>Save</strong>.
    <ul>
      <li>For the “Method type”, select <strong>ANY</strong> from the drop-down list.</li>
      <li>Select <strong>Lambda Proxy</strong> as the “Integration type”.</li>
      <li>Select the <code>gdk-serverless-demo-native</code> function from the drop-down list as the name of the Lambda Function.</li>
    </ul>
  </li>
  <li>
    <p>Click <strong>Deploy API</strong>.</p>
  </li>
  <li>
    <p>Select <strong>*New Stage*</strong> and click <strong>Deploy</strong>.</p>
  </li>
  <li>In the stage you just created (named “default”), copy the <strong>Invoke URL</strong> value.</li>
</ol>
    
      <h2 id="5-test-lambda-function-gateway-deployment">
        
        
          5. Test Lambda Function Gateway Deployment <a href="#5-test-lambda-function-gateway-deployment" class="anchor_heading">#</a>
        
        
      </h2>

<p>Now the application is deployed to AWS, you can test it by sending requests.</p>

<ol>
  <li>
    <p>Define an environment variable for your gateway hostname:</p>

    <pre><code class="language-bash">  export GATEWAY_HOSTNAME=aaaaaaaaaa.execute-api.us-east-2.amazonaws.com/default
</code></pre>

    <blockquote>
      <p>Note: On Windows, use <code>set GATEWAY_HOSTNAME=&lt;hostname&gt;</code> to set it and <code>%GATEWAY_HOSTNAME%</code> to access it. Or you can skip this step and paste the hostname to each of the following commands manually.</p>
    </blockquote>
  </li>
  <li>
    <p>Use <code>curl</code> to retrieve all the items:</p>

    <pre><code class="language-bash"> curl https://$GATEWAY_HOSTNAME/store/all
</code></pre>
    <pre><code class="language-json"> [
   {
     "name": "chair",
     "description": "A black chair with 4 legs",
     "numberInStorage": 10
   },
   {
     "name": "table",
     "description": "A quality dining table",
     "numberInStorage": 6
   },
   {
     "name": "sofa",
     "description": "A gray sofa",
     "numberInStorage": 2
   },
   {
     "name": "bookshelf",
     "description": "A futuristic-looking bookshelf",
     "numberInStorage": 0
   }
 ]
</code></pre>
  </li>
  <li>
    <p>Get an error when attempting to order too many items:</p>

    <pre><code class="language-bash"> curl -X POST https://$GATEWAY_HOSTNAME/store/order/table/10
</code></pre>
    <pre><code class="language-json"> {"message": "Bad Request",
   "_embedded": {
     "errors": [{
       "message": "Could not order item 'table'. Insufficient amount in storage"
     }]
   }, ...
 }
</code></pre>
  </li>
  <li>
    <p>Order an item and print the response status code:</p>

    <pre><code class="language-bash"> curl -X POST -w "\nStatus code: %{http_code}" https://$GATEWAY_HOSTNAME/store/order/table/6
</code></pre>
    <pre><code class="language-json"> {
   "name":"table",
   "description":"A quality dining table",
   "numberInStorage":0
 }
 Status code: 200
</code></pre>
  </li>
  <li>
    <p>Get the available items:</p>

    <pre><code class="language-bash"> curl https://$GATEWAY_HOSTNAME/store/available
</code></pre>
    <pre><code class="language-json"> [
   {
     "name": "chair",
     "description": "A black chair with 4 legs",
     "numberInStorage": 10
   },
   {
     "name": "sofa",
     "description": "A gray sofa",
     "numberInStorage": 2
   }
 ]
</code></pre>
  </li>
</ol>
    
      <h3 id="summary">
        
        
          Summary <a href="#summary" class="anchor_heading">#</a>
        
        
      </h3>

<p>This guide demonstrated how to create a Micronaut application, compile it into a native executable and containerize, run it as an Amazon Lambda Function, and setup the API Gateway to provide access it.</p>
    
      <h3 id="related-documentation">
        
        
          Related Documentation <a href="#related-documentation" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li><a href="https://micronaut-projects.github.io/micronaut-aws/latest/guide/#lambda">Micronaut AWS Lambda Support</a></li>
  <li><a href="https://aws.amazon.com/lambda/">AWS Lambda</a></li>
  <li><a href="https://graalvm.github.io/native-build-tools/latest/index.html">Native Build Tools</a></li>
  <li><a href="https://www.graalvm.org/">GraalVM Native Image</a></li>
</ul>

      </div>

      <div role="button" class="menu-btn menu-btn--sidebar js-show-sidebar" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
    </div>
  </div>
</article>



</div>

      </main>

      
<footer class="footer footer__mobile">

  <div class="container-fluid container-fluid--custom-sm">
    <div class="row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <div class="row footer-content">
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">Learn</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/get-started/">Get Started</a></li>
                <li class="footer-list__item"><a href="/gdk/guides/">Guides</a></li>
                <li class="footer-list__item"><a href="/gdk/hands-on-labs/">Labs</a></li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/logo-github.svg" alt="Github icon">
                  <a href="https://github.com/oracle/graal-dev-kit" target="blank">Github</a>
                </li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/slack-icon.svg" alt="Github icon">
                  <a href="https://bit.ly/odevrel_slack" target="blank">#graal-dev-kit-for-micronaut</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">About</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/about/#gdk-support" target="blank">Commercial Support</a></li>
                <li class="footer-list__item"><a href="https://www.graalvm.org/" target="blank">GraalVM Native Image</a></li>
                <li class="footer-list__item"><a href="https://micronaut.io/" target="_blank">Micronaut<sup>&reg;</sup> Framework</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/multicloud/what-is-multicloud/" target="_blank">Multicloud</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/" target="blank">Oracle Cloud Infrastructure</a></li>
                <li class="footer-list__item"><a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.graal-cloud-native-pack" target="blank">VS Code Tools</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md-6 col-sm-12 aligning_1024">
            <div class="card--footer card--hovered box">
              <div>
                <div class="rubber-footer footer__oci-section">
                  <p class="title-footer quickstart">Build, test, and deploy applications on Oracle Cloud Infrastructure for free</p>
                  <a href="https://www.oracle.com/cloud/free/" target="_blank"
                    class="btn btn-primary">Try Oracle Cloud Infrastructure Free Tier</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
          <div class="row">
            <div class="col-sm-12">
              <p class="copyright">
                Copyright &copy; 2023-2024, Oracle and/or its affiliates.
                All rights reserved.
                Oracle and Java are registered trademarks of Oracle and/or its affiliates.<br/>
                Micronaut<sup>&reg;</sup> is a registered trademark of Object Computing, Inc.
                Use is for referential purposes and does not imply any endorsement or affiliation with any third-party product.
                Unauthorized use is strictly prohibited. Other names may be trademarks of their respective owners.
              </p>
              <div id="teconsent"></div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</footer>

<script>
  function fadeInAndOut(thz) {
    var elmt = thz.nextElementSibling;//Get the element that is below the button that
    //was just clicked
    if (elmt.clientHeight) {
      elmt.style.height = 0;
    } else {
      var wrapper = elmt.querySelector('ul');
      elmt.style.height = wrapper.clientHeight + "px";
    }
    /*
        elmt.classList.toggle("acordianPanelHidden");//Toggle the class which changes
        //attributes which triggers the transition CSS
        */
  }

  // Check TRUSTe Consent for Functional or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(2) != -1) ) {

      //The following is a sample of a Maxymiser Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript" src="//service.maxymiser.net/cdn/oracle/js/mmcore.js"><\/script>');
  }

  // Check TRUSTe Consent for Advertising or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(3) != -1) ) {

      //The following is a sample of a BlueKai Core Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript">' +
      'window.bk_async = function() { ' +
      'BKTAG.doTag(62581, 1); }; ' +
      '(function() { ' +
      'var scripts = document.getElementsByTagName(\'script\')[0]; ' +
      'var s = document.createElement(\'script\'); ' +
      's.async = true; ' +
      's.src = "https://tags.bkrtx.com/js/bk-coretag.js"; ' +
      'scripts.parentNode.insertBefore(s, scripts); ' +
      '}()); ' +
      '<\/script>');
  }
</script>

    </div>
    <div class="overlay"></div>

    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <script src='/gdk/resources/lib/slick-slider/slick.min.js'></script>
    <script src='/gdk/resources/js/main.js'></script>
    <script src='/gdk/resources/js/ui.js'></script>
    <script src='/gdk/resources/js/filters.js'></script>
    <script src='/gdk/resources/js/sidebar.js'></script>
    <script src='/gdk/resources/js/labs.js'></script>
    <script src='/gdk/resources/lib/highlight/highlight.min.js'></script>
    <script>hljs.highlightAll();</script>
  </body>
</html>
