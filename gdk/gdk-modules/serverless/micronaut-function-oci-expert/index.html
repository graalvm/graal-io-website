<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/gdk/resources/img/graalvm.png" />
  <meta name="twitter:widgets:border-color" content="#55acee">

  <title>
    
      Expert&#39;s Guide to Create and Deploy a Micronaut Gateway Function to Oracle Cloud Infrastructure
    
  </title>
  <meta name="description" content="The Graal Development Kit for Micronaut (GDK) is a build of a curated set of Micronaut framework modules and their required libraries for building portable c..."/>
  <meta name="last_modified" content="2024-07-08 11:41:21 +0000"/>
  <meta name="last_built" content="2024-12-02 15:15:17 +0000"/>
  <link rel="stylesheet" href="/gdk/assets/main.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/gdk/resources/img/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/gdk/resources/img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/gdk/resources/img/favicon/favicon-16x16.png">
  <link rel="manifest" href="/gdk/resources/img/favicon/site.webmanifest">
  <link rel="stylesheet" type="text/css" href="/gdk/resources/styles/codicon.css" />
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="-vRqwa9WYn6AaQGnl88xvrLw6ac4xoKVkZkhanmlRhU" />
  <link rel="canonical" href="https://www.graal.cloud/gdk/gdk-modules/serverless/micronaut-function-oci-expert/">

  <!-- jQuery UI Tabs -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/gdk/resources/lib/jquery/jquery-ui.css">
</head>

      <script src="/gdk/resources/lib/jquery/jquery-3.7.1.min.js"></script>
    <script src="/gdk/resources/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src='/gdk/resources/lib/sticky-sidebar/resizeSensor.js'></script>
    <script src='/gdk/resources/lib/sticky-sidebar/sticky-sidebar.min.js'></script>
    <script src="/gdk/resources/lib/highlight/highlight.min.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Add TRUSTe Consent Script and Analytics -->
    <script async="async" type="text/javascript" src='//consent.trustarc.com/notice?domain=oracle.com&c=teconsent&js=bb&noticeType=bb&text=true&cdn=1&pcookie&gtm=1' crossorigin></script>
    <script src="https://www.oracle.com/assets/truste-oraclelib.js"></script>
    <!-- jQuery UI Tabs -->
    <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>


  <body class="preload">
    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <div  class="wrapper wrapper--nofooter" >

      <header  class="header header--content" 
  role="banner">

  

  

    <nav class="menu">
      <div class="menu__row">
        <div>
          <a href="/gdk/">
            <img class="logo-mobile" src="/gdk/resources/img/gdk-logo-new.svg" alt="Graal Development Kit for Micronaut logo">
          </a>
        </div>
        <div class="menu__container">
          <ul class="menu__list">
            <li class="menu__item">
              <a href="/gdk/about/" class="menu__link">About</a>
            </li>
            <li class="menu__item">
              <a href="/gdk/get-started/" class="menu__link">Get Started</a>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Docs</a>
                <div class="stack-menu-learn">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/modules.svg'>
                        <a href="/gdk/modules/" class="item-line">Modules</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/guides.svg'>
                        <a href="/gdk/guides/" class="item-line">Guides</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/labs.svg'>
                        <a href="/gdk/hands-on-labs/" class="item-line">Hands-On Labs</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/tools.svg'>
                        <a href="/gdk/vscode-tools/" class="item-line">Tools</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Graal Projects</a>
                <div class="stack-menu">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalstack.svg'>
                        <a href="https://graal.cloud/" class="item-line">Graal</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalvm.svg'>
                        <a href="https://graalvm.org/" class="item-line">GraalVM</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalos.svg'>
                        <a href="https://graal.cloud/graalos/" class="item-line">GraalOS</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__launch__mobile">
              <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
            </li>
          </ul>
        </div>
        <div class="menu__launch">
          <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
        </div>
      </div>

      <div role="button" class="menu-btn menu-btn--menu js-show-menu" tabindex="-1" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
      <button aria-label="hamburger mobile menu" class="btn btn-mobile-menu js-show-menu">
        <div class="inner"></div>
      </button>
    </nav>

  
</header>


      <main  class="content"   aria-label="Content">
        <div class="wrapper wrapper-content">
  <article>
  <div class="row d-flex flex-wrap">
    <div class="col-sm-3 docsimpro col-bg">
      <div class="sidebar-wrap">
        <div class="sidebar">
          <div class="menuabout">
            <img id="sidebarClose" src="/gdk/resources/img/arrow_sidebar(close).svg" alt="Expand or collapse sidebar"
              class="btn-color no-display">
            <img id="sidebarOpen" src="/gdk/resources/img/arrow_sidebar.svg" alt="Expand or collapse sidebar">
          </div>
          
<div class="toc-floating">


<div class="toc-bullets">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    

    
      
        
          <li class="toc-bullets-main">
        
          
          <a href="/gdk/docs/gdk-modules/serverless/" class="_icon-book">
            Serverless
          </a>
        </li>

        
        

        
        
          
          <li class="toc-bullets-sub toc-bullets-highlight">
          
            
            <a href="/gdk/gdk-modules/serverless/micronaut-function-oci-expert/">
              Expert&#39;s Guide to Create and Deploy a Micronaut Gateway Function to Oracle Cloud Infrastructure
            </a>
          </li>

          
            <div>
  <script>
    var scriptElement = document.currentScript;
    var div = $(scriptElement.parentElement);
    $(window).on("load", function () {
      $("#content-wrapper h2").each(function () {
        var li = $("<li></li>", { class: "toc-bullets-sub toc-bullets-sub-3" });
        var a = $("<a></a>", { href: "#" + $(this).attr("id") });
        a.text($(this).text().replace('#', ''));
        li.append(a);
        li.click(function (e) {
          e.preventDefault();
          var target = $(a.attr('href'));
          var scrollTo = target.offset().top - 80; // 80 - indent
          $('html, body').animate({ scrollTop: scrollTo }, 1000);
        });
        div.append(li);
      });
    });
  </script>
</div>
          
        
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

<!-- <li class="search additional-search">
  <form class="form-inline sidebar" action="/docs/search" autocomplete="on" method="get">
    <input class="input-search sidebar" type="text" id="search-box" name="query" placeholder="Search">
    <button type="submit sidebar" class="search-button"></button>
  </form>
</li> -->

</div>
  <!-- Search form -->
  <!-- <form class="search-container" action="/docs/search" autocomplete="on" method="get">
   <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <button type="submit" class="searchbttn"></button>
  </form> -->
</div>

        </div>
      </div>
    </div>

    <div class="col-sm-9 docsmod">
      <div id="content-wrapper" class="docs-content docs-content--with-sidebar">
        <!--
          Include file to warn of Windows/Gradle restriction
        -->
        <h1 id="experts-guide-to-create-and-deploy-a-micronaut-gateway-function-to-oracle-cloud-infrastructure">
        
        
          Expert’s Guide to Create and Deploy a Micronaut Gateway Function to Oracle Cloud Infrastructure
        
        
      </h1>

<p>This guide describes how to use the Graal Development Kit for Micronaut (GDK) to create a Micronaut<sup>®</sup> Gateway Function, deploy it as a container image, using Oracle Cloud Infrastructure <a href="https://docs.oracle.com/iaas/Content/Functions/home.htm" target="_blank">Functions</a>, and access it via Oracle Cloud Infrastructure <a href="https://docs.oracle.com/iaas/Content/APIGateway/home.htm" target="_blank">API Gateway</a>.</p>

<blockquote>
  <p>A Micronaut Gateway Function acts a a serverless cloud (HTTP) API gateway function.</p>
</blockquote>

<blockquote>
  <p>Oracle Cloud Infrastructure Functions is a fully managed, multitenant, highly scalable, on-demand, Functions-as-a-Service platform.</p>
</blockquote>

<p>The guide consists of the following steps:</p>

<ol>
  <li>Use the GDK Launcher to create a Micronaut Gateway Function</li>
  <li>Create the code to implement the gateway function</li>
  <li>Deploy the gateway function as a container image to a <a href="hhttps://docs.oracle.com/iaas/Content/Registry/Concepts/registryoverview.htm" target="_blank">Container Repository in Oracle Cloud Infrastructure Registry</a></li>
  <li>Create and deploy an Oracle Function based on the container image of the gateway function</li>
  <li>Create and deploy an Oracle Cloud Infrastructure <a href="https://docs.oracle.com/iaas/Content/APIGateway/home.htm" target="_blank">API Gateway</a> to access the Oracle Function</li>
</ol>

<p>This guide assumes you are familiar with the Oracle Cloud Console.</p>
    
      <h3 id="prerequisites">
        
        
          Prerequisites <a href="#prerequisites" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li>JDK 17 or higher. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>.</li>
  <li>An Oracle Cloud Infrastructure account. See <a href="/gdk/get-started/setting-up-cloud-accounts/">Setting up Your Cloud Accounts</a>.</li>
  <li>A Docker-API compatible container runtime such as <a href="https://docs.rancherdesktop.io/getting-started/installation/">Rancher Desktop</a> or <a href="https://www.docker.io/gettingstarted/">Docker</a> installed and running.</li>
  <li>An SSH key. See <a href="https://docs.oracle.com/en/learn/generate_ssh_keys/index.html">Generate SSH keys</a>.</li>
  <li>The GDK CLI. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>. (Optional.)</li>
</ul>

<p>Follow the steps below to create a Micronaut gateway function from scratch. However, you can also download the completed example:</p>

<div id="tabs-doc1">
  <ul>
    <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <p><a href="https://github.com/oracle/graal-dev-kit/releases/download/4.6.0.3/4.6.0.3_serverless_oci-serverless-demo-java-gradle.zip">Gradle Oracle Cloud Infrastructure Serverless Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
  <div id="maven">
    <p><a href="https://github.com/oracle/graal-dev-kit/releases/download/4.6.0.3/4.6.0.3_serverless_oci-serverless-demo-java-maven.zip">Maven Oracle Cloud Infrastructure Serverless Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
</div>
    
      <h4 id="a-note-regarding-your-development-environment">
        
        
          A note regarding your development environment
        
        
      </h4>

<p>Consider using Visual Studio Code, which provides native support for developing applications with the <a href="/gdk/vscode-tools/using-gdk-vscode-tools/">Graal Development Kit extension</a>.</p>

<p>If you use IntelliJ IDEA, <a href="/gdk/resources/img/annotationprocessorsintellij.png">enable annotation processing</a>.</p>

<blockquote>
  <p>Windows platform: The GDK guides are compatible with Gradle only. Maven support is coming soon.</p>
</blockquote>
    
      <h2 id="1-create-the-gateway-function">
        
        
          1. Create the Gateway Function <a href="#1-create-the-gateway-function" class="anchor_heading">#</a>
        
        
      </h2>

<p>This section describes how to create a Micronaut gateway function for a simple online store. The store provides information about available items and enables the user to order items. An HTTP controller is responsible for the API implementation and a service stores the availability of items.</p>

<p>Create a Micronaut gateway function using the GDK Launcher.</p>

<ol>
  <li>
    <p>Open the <a href="/gdk/launcher/?advanced=true">GDK Launcher in advanced mode</a>.</p>
  </li>
  <li>Create a new project using the following selections.
    <ul>
      <li><strong>Project Type</strong>: <em>Gateway Function</em></li>
      <li><strong>Project Name</strong>: <em>oci-serverless-demo</em></li>
      <li><strong>Base Package</strong>: <em>com.example</em> (Default)</li>
      <li><strong>Clouds</strong>: <em>OCI</em></li>
      <li><strong>Build Tool</strong>: <em>Gradle (Groovy)</em> or <em>Maven</em></li>
      <li><strong>Language</strong>: <em>Java</em> (Default)</li>
      <li><strong>Test Framework</strong>: <em>JUnit</em> (Default)</li>
      <li><strong>Java Version</strong>: <em>17</em> (Default)</li>
      <li><strong>Micronaut Version</strong>: (Default)</li>
      <li><strong>Cloud Services</strong>: <em>None</em></li>
      <li><strong>Features</strong>: <em>GraalVM Native Image</em> and <em>Micronaut Validation</em></li>
      <li><strong>Sample Code</strong>: <em>No</em></li>
    </ul>
  </li>
  <li>Click <strong>Generate Project</strong>, then click <strong>Download Zip</strong>. The GDK Launcher creates a Micronaut gateway function with the default package <code>com.example</code> in a directory named <em>oci-serverless-demo</em>. The application ZIP file will be downloaded to your default downloads directory. Unzip it, open it in your code editor, and proceed to the next steps.</li>
</ol>

<p>Alternatively, use the GDK CLI as follows:</p>

<div id="tabs-doc2">
  <ul>
    <li class="tabs-gradle"><a href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <pre><code class="language-bash">gdk create-gateway-function com.example.oci-serverless-demo \
    --clouds=oci \
    --features=graalvm,validation \
    --example-code=false \
    --jdk=17 \
    --build=gradle \
    --lang=java</code></pre>
  </div>
  <div id="maven">
    <pre><code class="language-bash">gdk create-gateway-function com.example.oci-serverless-demo \
    --clouds=oci \
    --features=graalvm,validation \
    --example-code=false \
    --jdk=17 \
    --build=maven \
    --lang=java</code></pre>
  </div>
</div>

<p>For more information, see <a href="/gdk/get-started/using-gdk-cli/">Using the GDK CLI</a>.</p>

<p>The GDK Launcher creates a multi-module project with two subprojects: <strong>oci</strong> for Oracle Cloud Infrastructure, and <strong>lib</strong>.
You develop the gateway function logic in the <strong>oci</strong> subproject. If your gateway function is to be deployed to multiple cloud providers, use the <strong>lib</strong> subproject to create classes that can be shared between the providers. This enables you to separate the code that is different between cloud providers, while keeping most of the implementation in the common <strong>lib</strong> subproject.</p>
    
      <h3 id="11-storeitem">
        
        
          1.1. StoreItem <a href="#11-storeitem" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create a <code>StoreItem</code> model to represent an item in the store in the file <em>lib/src/main/java/com/example/StoreItem.java</em> with the following contents:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.core.annotation.Introspected;
import io.micronaut.core.annotation.NonNull;

import io.micronaut.serde.annotation.Serdeable;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotBlank;

@Serdeable
@Introspected // &lt;1&gt;
public class StoreItem {

    @NotBlank
    @NonNull
    private final String name;

    private final String description;

    @Min(0)
    private int numberInStorage;

    public StoreItem(String name, String description, int numberInStorage) { // &lt;2&gt;
        this.name = name;
        this.description = description;
        this.numberInStorage = numberInStorage;
    }

    public String getName() {
        return name;
    }

    public String getDescription() {
        return description;
    }

    public Integer getNumberInStorage() {
        return numberInStorage;
    }

    public void setNumberInStorage(Integer numberInStorage) {
        this.numberInStorage = numberInStorage;
    }
}
</code></pre>

<p><strong>1</strong> The <a href="https://micronaut-projects.github.io/micronaut-core/latest/api/io/micronaut/core/annotation/Introspected.html"><code>@Introspected</code></a> annotation enables Micronaut to serialize and deserialize the model from different formats including <code>JSON</code>. This provides the ability to use the type inside HTTP requests or responses.</p>

<p><strong>2</strong> The model has fields to store the item’s name, description, and number available.</p>
    
      <h3 id="12-storecontroller">
        
        
          1.2. StoreController <a href="#12-storecontroller" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create an HTTP controller in the file <em>lib/src/main/java/com/example/StoreController.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.PathVariable;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.exceptions.HttpStatusException;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;

import java.util.Collection;
import java.util.stream.Collectors;

import static io.micronaut.http.HttpStatus.BAD_REQUEST;
import static io.micronaut.http.HttpStatus.NOT_FOUND;

@Controller("/store") // &lt;1&gt;
class StoreController {

    private final StorageService storageService;

    StoreController(StorageService storageService) { // &lt;2&gt;
        this.storageService = storageService;
    }

    @Get("/all") // &lt;3&gt;
    Collection&lt;StoreItem&gt; listAllItems() {
        return storageService.getItems();
    }

    @Get("/available") // &lt;4&gt;
    Collection&lt;StoreItem&gt; listAvailableItems() {
        return storageService.getItems().stream()
                .filter(i -&gt; i.getNumberInStorage() &gt; 0)
                .collect(Collectors.toList());
    }

    @Post(uri = "/order/{name}/{amount}", consumes = "*/*") // &lt;5&gt;
    HttpResponse&lt;StoreItem&gt; orderItem(@NotBlank @PathVariable String name, @Min(1) int amount) {
        if (storageService.findItem(name).isEmpty()) {
            throw new HttpStatusException(NOT_FOUND, "Item '" + name + "' not found");
        }
        try {
            storageService.orderItem(name, amount);
        } catch (StorageService.StorageException e) {
            throw new HttpStatusException(BAD_REQUEST, "Could not order item '" + name + "'. " + e.getMessage());
        }
        return HttpResponse.ok(storageService.findItem(name).orElse(null));
    }
}
</code></pre>

<p><strong>1</strong> The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html"><code>@Controller</code></a> annotation mapped to the path <code>/store</code>.</p>

<p><strong>2</strong> Use <a href="https://docs.micronaut.io/latest/guide/#qualifiers">Micronaut argument injection</a> to inject a <code>StorageService</code> bean by defining it as the constructor argument. You will create the <code>StorageService</code> in next section.</p>

<p><strong>3</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html"><code>@Get</code></a> annotation maps the <code>listAllItems</code> method to an HTTP GET request on <code>/store/all</code>.</p>

<p><strong>4</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html"><code>@Get</code></a> annotation maps the <code>listAvailableItems</code> method to an HTTP GET request on <code>/store/available</code>.</p>

<p><strong>5</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Post.html"><code>@Post</code></a> annotation maps the <code>orderItem</code> method to an HTTP POST request on <code>/store/order/{name}/{amount}</code>. Use the <code>consumes</code> argument to specify which content-types are allowed in the request. Throwing <code>HttpStatusException</code> will set the corresponding HTTP status in the response.</p>
    
      <h3 id="13-storageservice">
        
        
          1.3. StorageService <a href="#13-storageservice" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>Create an interface for a service that represents the store’s inventory in <em>lib/src/main/java/com/example/StorageService.java</em>:</p>

    <pre><code class="language-java"> package com.example;

 import io.micronaut.core.annotation.NonNull;

 import jakarta.validation.constraints.Min;
 import jakarta.validation.constraints.NotBlank;
 import java.util.Collection;
 import java.util.Optional;

 public interface StorageService { // &lt;1&gt;
     Collection&lt;StoreItem&gt; getItems();
     Optional&lt;StoreItem&gt; findItem(@NonNull @NotBlank String name);
     void orderItem(@NonNull @NotBlank String name, @Min(1) int amount);

     class StorageException extends RuntimeException { // &lt;2&gt;
         StorageException(String message) {
             super(message);
         }
     }
 }
</code></pre>

    <p><strong>1</strong> The storage service provides information about all the items, finds an items by its name, and can place an order for an item.</p>

    <p><strong>2</strong> The class includes a custom exception that thrown in case of invalid requests to storage.</p>
  </li>
  <li>
    <p>Create an implementation of the service interface in <em>lib/src/main/java/com/example/DefaultStorageService.java</em>:</p>

    <pre><code class="language-java"> package com.example;

 import io.micronaut.context.annotation.Requires;
 import io.micronaut.core.annotation.NonNull;
 import jakarta.inject.Singleton;

 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.List;
 import java.util.Optional;

 @Singleton // &lt;1&gt;
 @Requires(missingBeans = StorageService.class) // &lt;2&gt;
 class DefaultStorageService implements StorageService {

     protected List&lt;StoreItem&gt; items = List.of( // &lt;3&gt;
         new StoreItem("chair", "A black chair with 4 legs", 10),
         new StoreItem("table", "A quality dining table", 6),
         new StoreItem("sofa", "A gray sofa", 2),
         new StoreItem("bookshelf", "A futuristic-looking bookshelf", 0)
     );

     @Override
     public Collection&lt;StoreItem&gt; getItems() {
         return items;
     }

     @Override
     public Optional&lt;StoreItem&gt; findItem(@NonNull String name) {
         return items.stream().filter(item -&gt; item.getName().equals(name)).findFirst();
     }

     @Override
     public void orderItem(@NonNull String name, int amount) {
         findItem(name).ifPresentOrElse(item -&gt; {
             if (item.getNumberInStorage() &gt;= amount) {
                 item.setNumberInStorage(item.getNumberInStorage() - amount);
             } else {
                 throw new StorageException("Insufficient amount in storage");
             }
         }, () -&gt; { throw new StorageException("Item not found in storage"); });
     }
 }
</code></pre>

    <p><strong>1</strong> Use <code>jakarta.inject.Singleton</code> to designate a class as a singleton.</p>

    <p><strong>2</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/context/annotation/Requires.html"><code>@Requires(missingBeans = StorageService.class)</code></a> annotation specifies that this implementation should only be used if no other implementations could be found.</p>

    <p><strong>3</strong> The implementation stores the items in a <code>List</code> and populates some sample items in the list.</p>
  </li>
</ol>

<p>If you wish to implement a more advanced <code>StorageService</code> to be used instead of this one, annotate your implementation with <code>@Singleton</code> as shown above. Use the <code>@Requires(env = "oraclecloud")</code> annotation to make it specific to Oracle Cloud Infrastructure. Visit the <a href="/gdk/modules/#database">Database Module</a> for details about how to store and manipulate data in a database.</p>
    
      <h3 id="14-tests-to-verify-gateway-function-logic">
        
        
          1.4. Tests to Verify Gateway Function Logic <a href="#14-tests-to-verify-gateway-function-logic" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create a test class for the controller in <em>oci/src/test/java/com/example/StoreControllerTest.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.http.client.exceptions.HttpClientResponseException;
import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
import jakarta.inject.Inject;
import jakarta.inject.Singleton;
import org.junit.jupiter.api.Test;

import java.util.ArrayList;
import java.util.List;

import static io.micronaut.http.HttpStatus.BAD_REQUEST;
import static io.micronaut.http.HttpStatus.NOT_FOUND;
import static io.micronaut.http.HttpStatus.OK;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;

@MicronautTest(environments = "test-storage-service") // &lt;1&gt;
class StoreControllerTest {

   @Inject
   StoreClient client;

   @Test
   void testAvailableItems() {
      List&lt;StoreItem&gt; availableItems = client.getAvailable();

      assertEquals(2, availableItems.size());
      assertEquals("pot", availableItems.get(1).getName());
      assertEquals(10, availableItems.get(1).getNumberInStorage());
      assertNotNull(availableItems.get(1).getDescription());
   }

   @Test
   void testNotFoundException() {
      HttpResponse&lt;?&gt; response = client.order("lamp", 1);

      assertEquals(NOT_FOUND, response.getStatus());
   }

   @Test
   void testNotSufficientException() {
      HttpClientResponseException e = assertThrows(HttpClientResponseException.class, () -&gt; {
         client.order("pot", 100);
      });

      assertEquals(BAD_REQUEST, e.getStatus());
   }

   @Test
   void testOrderRequest() {
      StoreItem plate = client.getAll().stream()
              .filter(i -&gt; i.getName().equals("plate"))
              .findFirst().orElse(null);
      assertNotNull(plate);
      assertEquals(100, plate.getNumberInStorage());

      HttpResponse&lt;StoreItem&gt; response = client.order("plate", 10);
      assertEquals(OK, response.getStatus());
      assertNotNull(response.body());
      assertEquals("plate", response.body().getName());
      assertEquals(90, response.body().getNumberInStorage());
   }

   @Singleton
   @Requires(env = "test-storage-service")
   static class TestStorageService extends DefaultStorageService {
      TestStorageService() { // &lt;2&gt;
         items = List.of(
                 new StoreItem("plate", "A large plate", 100),
                 new StoreItem("pot", "A cooking pot", 10),
                 new StoreItem("pan", "A large pan", 0)
         );
      }
   }

   @Client("/store") // &lt;3&gt;
   interface StoreClient {
      @Get("/all") // &lt;4&gt;
      List&lt;StoreItem&gt; getAll();

      @Get("/available") // &lt;4&gt;
      List&lt;StoreItem&gt; getAvailable();

      @Post("/order/{name}/{amount}") // &lt;4&gt;
      HttpResponse&lt;StoreItem&gt; order(String name, Integer amount);
   }
}
</code></pre>
<p><strong>1</strong> Annotate the class with <a href="https://micronaut-projects.github.io/micronaut-test/latest/api/io/micronaut/test/annotation/MicronautTest.html"><code>@MicronautTest</code></a> so the Micronaut framework will initialize the application context. This enables you to inject beans using the Jakarta <code>@Inject</code> annotation and to send requests to the <code>StoreController</code> defined in the application. Configure this test to use an identified environment using the <code>@MicronautTest(environments="test-storage-service")</code> annotation.</p>

<p><strong>2</strong> Create a mock implementation of <code>StorageService</code> so that the test is independent of the current state of the storage. The <code>@Requires(env="test-storage-service")</code> annotation specifies that the bean should only be available in the identified environment. (In this case it matches the one identified in the <code>@MicronautTest</code> annotation.)</p>

<p><strong>3</strong> Create a <a href="https://docs.micronaut.io/latest/guide/#clientAnnotation">Micronaut Declarative Client</a> with the same <code>/store</code> path to send requests to the controller.</p>

<p><strong>4</strong> Create three tests using the defined client and assuming that <code>TestStorageService</code> is used.</p>
    
      <h2 id="2-run-the-tests">
        
        
          2. Run the Tests <a href="#2-run-the-tests" class="anchor_heading">#</a>
        
        
      </h2>

<p>Run the tests using the following command:</p>

<div id="tabs-doc3">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">
        <pre><code class="language-bash">./gradlew test</code></pre>
        <p>Then open the file <em>oci/build/reports/tests/test/index.html</em> in a browser to view the results.</p>
    </div>
    <div id="maven">
        <pre><code class="language-bash">./mvnw test</code></pre>
    </div>
</div>

<p>Although you created this gateway function to run on Oracle Cloud Infrastructure, the tests should run successfully on your local machine.</p>

<p>Furthermore, Micronaut has a test implementation that simulates the Oracle Cloud Infrastructure Functions environment. Since sequential requests to a function may be processed by different instances, Micronaut creates a separate environment for each request in a test.</p>
    
      <h2 id="3-set-up-oracle-cloud-infrastructure">
        
        
          3. Set Up Oracle Cloud Infrastructure <a href="#3-set-up-oracle-cloud-infrastructure" class="anchor_heading">#</a>
        
        
      </h2>

<p>This guide requires the following Oracle Cloud Infrastructure resources:</p>

<ul>
  <li>A <a href="https://docs.oracle.com/iaas/Content/Registry/Concepts/registryoverview.htm" target="_blank">Container Repository in Oracle Cloud Infrastructure Registry</a> named “gdk-function-demo”</li>
  <li>An Oracle <a href="https://docs.oracle.com/iaas/Content/Functions/Concepts/functionsconcepts.htm#applications" target="_blank">Application</a> to deploy your Oracle Function</li>
  <li>An <a href="https://docs.oracle.com/iaas/Content/APIGateway/Concepts/apigatewayoverview.htm" target="_blank">API Gateway</a> to provide access to your Oracle Function</li>
  <li>A <a href="https://docs.oracle.com/iaas/Content/GSG/Tasks/creatingnetwork.htm" target="_blank">Virtual Cloud Network</a>
    <ul>
      <li>A public subnet open to the internet</li>
      <li>A private subnet to the API Gateway</li>
    </ul>
  </li>
  <li>An <a href="https://docs.oracle.com/iaas/Content/Identity/Concepts/overview.htm" target="_blank">Identity and Access Management (IAM) Policy</a> to give the API Gateway permission to call your Oracle Function.</li>
</ul>

<p>This section describes how to create a container image from the function and publish it to Oracle Cloud Infrastructure Registry (also known as Container Registry).</p>
    
      <h3 id="31-authenticate-with-container-registry">
        
        
          3.1. Authenticate with Container Registry <a href="#31-authenticate-with-container-registry" class="anchor_heading">#</a>
        
        
      </h3>

<p><a href="https://docs.oracle.com/iaas/Content/Registry/Concepts/registryoverview.htm">Container Registry</a> is an Oracle-managed registry to store, share, and manage container images (such as Docker images).</p>

<p>Before you can publish a container image to Container Registry, you must first authenticate with it. For this, create an authentication token and retrieve a few more properties.</p>

<ol>
  <li>
    <p>Find out your <strong>Object storage namespace</strong> by viewing your <a href="https://cloud.oracle.com/tenancy">Tenancy details</a> page. Make a note of it.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-os-namespace.png" alt="Oracle Cloud Infrastructure Tenancy Details Page" /></p>
  </li>
  <li>
    <p>An authentication token is bound to a user, so first select a user. In the Oracle Cloud Console, open the navigation menu, click <strong>Identity &amp; Security</strong>. Under <strong>Identity</strong> click <strong>Users</strong>. Click the name of the user.</p>
  </li>
  <li>
    <p>Scroll to the bottom of the <strong>User Details</strong> page, and select <strong>Auth tokens</strong> in the Resources section. Click <strong>Generate token</strong>:</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-auth-token1.png" alt="Oracle Cloud Infrastructure Auth Tokens" /></p>

    <ul>
      <li>
        <p>Create a description for the token and click <strong>Generate token</strong>:</p>

        <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-auth-token2.png" alt="Oracle Cloud Infrastructure Create Auth Token" /></p>
      </li>
      <li>
        <p>Click <strong>Copy</strong> to copy the generated token:</p>

        <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-auth-token3.png" alt="Oracle Cloud Infrastructure Copy Auth Token" /></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Find out your region identifier. You can see your region on the right of the header in the Oracle Cloud Console. Look for your region identifier in the <a href="https://docs.oracle.com/iaas/Content/General/Concepts/regions.htm">Oracle Cloud Infrastructure regions documentation page</a>. For example, <em>ca-toronto-1</em> is for Canada Southeast (Toronto).</p>
  </li>
  <li>
    <p>Authenticate with <code>docker</code> to Container Registry with your region identifier:</p>

    <pre><code class="language-bash">docker login &lt;region-identifier&gt;.ocir.io
</code></pre>
    <ul>
      <li>
        <p>When asked for a username, provide <code>&lt;object storage namespace&gt;/&lt;username&gt;</code>, for example <code>aaaaaaaaaaaa/example@example.com</code>.</p>
      </li>
      <li>
        <p>When asked for a password, provide the Auth token.</p>
      </li>
    </ul>

    <p>The command should complete by printing <code>Login Succeeded</code>. (It may take some time before the authentication token activates.)</p>
  </li>
</ol>
    
      <h3 id="32-publish-a-container-image-of-the-gateway-function-to-container-registry">
        
        
          3.2. Publish a Container Image of the Gateway Function to Container Registry <a href="#32-publish-a-container-image-of-the-gateway-function-to-container-registry" class="anchor_heading">#</a>
        
        
      </h3>

<p>To publish a container image to Container Registry, provide the path to a container repository in the build file.</p>

<div id="tabs-doc4">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">

<p>
Modify the <em>oci/build.gradle</em> file. Make sure it contains the following contents and that nothing overrides the set properties:
<pre><code class="language-java">
tasks {
    dockerfileNative {
      args("-XX:MaximumHeapSizePercent=80")
    }
    dockerBuild {
        images = ["[REGION].ocir.io/[TENANCY]/gdk-function-demo"]
    }

    dockerBuildNative {
        images = ["[REGION].ocir.io/[TENANCY]/gdk-function-demo"]
    }
}
</code></pre>
<ul>
   <li>
      Modify the <code>dockerBuild.images</code> property: enter your region identifier (<code>REGION</code>), and your object storage namespace (<code>TENANCY</code>) correctly. The value of the property should be similar to <code>ca-toronto-1.ocir.io/aaaaaaaaaaaa/gdk-function-demo</code>.
   </li>
   <li>
      Additionally, note that the value of <code>micronaut.runtime</code> is <code>oracle_function</code>.
   </li>
</ul>
</p>
<p>
Save the build file, then run the following command to create and publish a container image to Container Registry:
<pre><code class="language-bash">./gradlew oci:dockerPush</code></pre>
</p>

    </div>
    <div id="maven">
      <p>Modify the <em>oci/pom.xml</em> file as follows (and as shown below):
        <ul>
          <li>Insert the <code>&lt;regionIdentifier&gt;</code>, <code>&lt;objectStorageNamespace&gt;</code>, <code>&lt;jib.docker.image&gt;</code>, and <code>&lt;jib.docker.tag&gt;</code> elements to the <code>&lt;properties&gt;</code> element</li>
          <li>Replace <code>[REGION IDENTIFIER]</code> and <code>[OBJECT STORAGE NAMESPACE]</code> with their corresponding values from the previous step
            <pre><code class="language-xml">&lt;properties&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    ...
    &lt;micronaut.runtime&gt;oracle_function&lt;/micronaut.runtime&gt;
    ...
    &lt;regionIdentifier&gt;[REGION IDENTIFIER]&lt;/regionIdentifier&gt;
    &lt;objectStorageNamespace&gt;[OBJECT STORAGE NAMESPACE]&lt;/objectStorageNamespace&gt;
    &lt;jib.docker.image&gt;${regionIdentifier}.ocir.io/${objectStorageNamespace}/gdk-function-demo&lt;/jib.docker.image&gt;
    &lt;jib.docker.tag&gt;${project.version}&lt;/jib.docker.tag&gt;
    ...
&lt;/properties&gt;</code></pre>
          </li>
        </ul>
        <blockquote>
          <p>
            Note: <code>micronaut.runtime</code> property is already set to <code>oracle_function</code>.
          </p>
        </blockquote>
      </p>
      <p>
        Save the build file, then run the following commands to create and publish a container image to Container Registry:
      </p>
      <pre><code class="language-bash">./mvnw install -pl lib -am
./mvnw deploy -Dpackaging=docker -pl oci</code></pre>
    </div>
</div>
    
      <h3 id="33-create-a-virtual-cloud-network">
        
        
          3.3. Create a Virtual Cloud Network <a href="#33-create-a-virtual-cloud-network" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create a Virtual Cloud Network for the function.</p>

<ol>
  <li>
    <p>In the Oracle Cloud Console, open the navigation menu, click <strong>Networking</strong>. Click <strong>Virtual Cloud Networks</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Start VCN Wizard</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn2.png" alt="Oracle Cloud Infrastructure Virtual Cloud Networks" /></p>
  </li>
  <li>
    <p>Select <strong>Create VCN with Internet connectivity</strong>, click <strong>Start VCN Wizard</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn3.png" alt="Oracle Cloud Infrastructure VCN Wizard 1" /></p>
  </li>
  <li>
    <p>Enter a name for the VCN (such as “gdk-serverless-demo-vcn”) and select the desired compartment from the drop-down list. Click <strong>Next</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn4.png" alt="Oracle Cloud Infrastructure VCN Wizard 2" /></p>
  </li>
  <li>
    <p>Review the information and click <strong>Create</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn5.png" alt="Oracle Cloud Infrastructure VCN Wizard 3" /></p>
  </li>
</ol>

<p>When the VCN has been successfully created, click <strong>View Virtual Cloud Network</strong>. The next step is to add an ingress rule to allow HTTPS connections to the public subnet of the VCN.
<br />
<br /></p>

<ol>
  <li>
    <p>Select <strong>Security Lists</strong> from the list of Resources and then select the <strong>Default Security List</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn6.png" alt="Oracle Cloud Infrastructure VCN Security Lists" /></p>
  </li>
  <li>
    <p>Click <strong>Add Ingress Rules</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn7.png" alt="Oracle Cloud Infrastructure Security List Ingress Rules" /></p>
  </li>
  <li>
    <p>Use the following properties:</p>
    <ul>
      <li><strong>Source Type</strong>: <em>CIDR</em></li>
      <li><strong>Source CIDR</strong>: <em>0.0.0.0/0</em></li>
      <li><strong>IP Protocol</strong>: <em>TCP</em></li>
      <li><strong>Destination Port Range</strong>: <em>443</em></li>
    </ul>

    <p>Click <strong>Add Ingress Rules</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-vcn8.png" alt="Oracle Cloud Infrastructure Add Ingress Rules" /></p>
  </li>
</ol>
    
      <h3 id="34-create-an-application-and-a-function">
        
        
          3.4. Create an Application and a Function <a href="#34-create-an-application-and-a-function" class="anchor_heading">#</a>
        
        
      </h3>

<p>This section describes how to create an Oracle function.</p>

<ol>
  <li>
    <p>In the Oracle Cloud Console, open the navigation menu, click <strong>Developer Services</strong>. Under <strong>Functions</strong>, click <strong>Applications</strong>.</p>
  </li>
  <li>Click <strong>Create application</strong>.
Use the following properties, then click <strong>Create</strong>.
    <ul>
      <li><strong>Name</strong>: <em>gdk-serverless-demo</em></li>
      <li><strong>VCN</strong>: <em>gdk-serverless-demo-vcn</em></li>
      <li><strong>Subnets</strong>: <em>Public Subnet-gdk-serverless-demo-vcn</em> (Default)</li>
      <li><strong>Shape</strong>: Select <em>GENERIC_X86</em> (if your local environment is X86) or <em>GENERIC_ARM</em> (if your local environment is AArch64)</li>
    </ul>
  </li>
  <li>
    <p>On the <strong>Application Details</strong> page, click <strong>Functions</strong> under <strong>Resources</strong>.
Click <strong>Create function</strong> and select <strong>Create from existing image</strong>. (If required, change compartment to select your published container image.)</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-app4.png" alt="Oracle Cloud Infrastructure Functions" /></p>
  </li>
  <li>
    <p>Name the function as <code>gdk-serverless-func</code>, select a repository and a container image. Increase the memory to <code>512</code> and click <strong>Create</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-app5.png" alt="Oracle Cloud Infrastructure Create Function" /></p>
  </li>
</ol>
    
      <h2 id="4-create-an-api-gateway-in-oracle-cloud-infrastructure">
        
        
          4. Create an API Gateway in Oracle Cloud Infrastructure <a href="#4-create-an-api-gateway-in-oracle-cloud-infrastructure" class="anchor_heading">#</a>
        
        
      </h2>

<p>This section describes how to create an API Gateway in Oracle Cloud Infrastructure to provide access to the function.</p>
    
      <h3 id="41-create-an-api-gateway">
        
        
          4.1. Create an API Gateway <a href="#41-create-an-api-gateway" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>In the Oracle Cloud Console, open the navigation menu, click <strong>Developer Services</strong>. Under <strong>API Management</strong> click <strong>Gateways</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Create Gateway</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway2.png" alt="Oracle Cloud Infrastructure Gateways" /></p>
  </li>
  <li>
    <p>Enter <code>gdk-serverless-demo-gateway</code> as the name of the new gateway, <code>Public</code> as its type, and select your compartment. Choose your VCN and its public subnet. Click <strong>Create Gateway</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway3.png" alt="Oracle Cloud Infrastructure Create Gateways" /></p>
  </li>
</ol>
    
      <h3 id="42-create-a-deployment">
        
        
          4.2. Create a Deployment <a href="#42-create-a-deployment" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>On the <strong>API Gateway Details</strong> page, click <strong>Deployments</strong> under <strong>Resources</strong>. Click <strong>Create deployment</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway4.png" alt="Oracle Cloud Infrastructure Gateway Deployments" /></p>
  </li>
  <li>
    <p>Enter a name for the deployment, enter <code>/store</code> as the path prefix (as it is the prefix of the controller you created). Select your compartment and click <strong>Next</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway5.png" alt="Oracle Cloud Infrastructure Create Deployment 1" /></p>
  </li>
  <li>
    <p>Select <strong>No Authentication</strong> and click <strong>Next</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway6.png" alt="Oracle Cloud Infrastructure Create Deployment 2" /></p>
  </li>
  <li>
    <p>Enter <code>/{path*}</code> as the value of <code>path</code> to allow all paths (starting with the <code>/store</code> prefix). Allow all methods by selecting <code>ANY</code>. Select <code>Add single backend</code>, <code>Oracle functions</code>, choose the application and function from their respective drop-down lists. Click <strong>Next</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway7.png" alt="Oracle Cloud Infrastructure Create Deployment 3" /></p>
  </li>
  <li>
    <p>Review the deployment and click <strong>Create</strong>.</p>

    <p><img src="/gdk/docs/gdk-modules/serverless/images/oci-gateway8.png" alt="Oracle Cloud Infrastructure Create Deployment 4" /></p>
  </li>
</ol>

<p>After the deployment is created, on the page describing your new Gateway page, copy the hostname. This is the hostname that you will use to send requests to the function.</p>
    
      <h3 id="43-create-a-policy">
        
        
          4.3. Create a Policy <a href="#43-create-a-policy" class="anchor_heading">#</a>
        
        
      </h3>

<p>You must give the gateway permission to call the function. To do this, create a policy that will apply for all the API gateways in the compartment.</p>

<ol>
  <li>
    <p>In the Oracle Cloud Console, open the navigation menu, click <strong>Identity &amp; Security</strong>. Under <strong>Identity</strong> click <strong>Policies</strong>.</p>
  </li>
  <li>
    <p>Select the compartment and click <strong>Create Policy</strong>.</p>
  </li>
  <li>Provide a name for the policy, select your compartment, and select <strong>Show manual editor</strong>. Paste the following contents in the policy (filling in your compartment OCID):
    <pre><code class="language-text">Allow any-user to use functions-family in compartment id [YOUR COMPARTMENT OCID] where ALL {request.principal.type= 'ApiGateway', request.resource.compartment.id = '[YOUR COMPARTMENT OCID]'}
</code></pre>
  </li>
  <li>Click <strong>Create</strong>.</li>
</ol>
    
      <h2 id="5-test-the-oracle-function">
        
        
          5. Test the Oracle Function <a href="#5-test-the-oracle-function" class="anchor_heading">#</a>
        
        
      </h2>

<p>Now the application is deployed to Oracle Cloud Infrastructure, you can test it by sending requests.</p>

<ol>
  <li>
    <p>Define an environment variable for your gateway hostname:</p>

    <pre><code class="language-bash"> export GATEWAY_HOSTNAME=aaaaaaaaaaaaaaaaaaaaaaa.apigateway.ca-toronto-1.oci.customer-oci.com
</code></pre>

    <blockquote>
      <p>Note: On Windows, use <code>set GATEWAY_HOSTNAME=&lt;hostname&gt;</code> to set it and <code>%GATEWAY_HOSTNAME%</code> to access it. Or you can skip this step and paste the hostname to each of the following commands manually.</p>
    </blockquote>
  </li>
  <li>
    <p>Use <code>curl</code> to retrieve all the items:</p>

    <pre><code class="language-bash"> curl https://$GATEWAY_HOSTNAME/store/all
</code></pre>
    <pre><code class="language-json"> [
   {
     "name": "chair",
     "description": "A black chair with 4 legs",
     "numberInStorage": 10
   },
   {
     "name": "table",
     "description": "A quality dining table",
     "numberInStorage": 6
   },
   {
     "name": "sofa",
     "description": "A gray sofa",
     "numberInStorage": 2
   },
   {
     "name": "bookshelf",
     "description": "A futuristic-looking bookshelf",
     "numberInStorage": 0
   }
 ]
</code></pre>
  </li>
  <li>
    <p>Get an error when attempting to order too many items:</p>

    <pre><code class="language-bash"> curl -X POST https://$GATEWAY_HOSTNAME/store/order/table/10
</code></pre>
    <pre><code class="language-json"> {"message": "Bad Request",
   "_embedded": {
     "errors": [{
       "message": "Could not order item 'table'. Insufficient amount in storage"
     }]
   }, ...
 }
</code></pre>
  </li>
  <li>
    <p>Order an item and print the response status code:</p>

    <pre><code class="language-bash"> curl -X POST -w "\nStatus code: %{http_code}" https://$GATEWAY_HOSTNAME/store/order/table/6
</code></pre>
    <pre><code class="language-json"> {
   "name":"table",
   "description":"A quality dining table",
   "numberInStorage":0
 }
 Status code: 200
</code></pre>
  </li>
  <li>
    <p>Get the available items:</p>

    <pre><code class="language-bash"> curl https://$GATEWAY_HOSTNAME/store/available
</code></pre>
    <pre><code class="language-json"> [
   {
     "name": "chair",
     "description": "A black chair with 4 legs",
     "numberInStorage": 10
   },
   {
     "name": "sofa",
     "description": "A gray sofa",
     "numberInStorage": 2
   }
 ]
</code></pre>
  </li>
</ol>
    
      <h2 id="6-publish-a-native-executable-to-oracle-cloud-infrastructure">
        
        
          6. Publish a Native Executable to Oracle Cloud Infrastructure <a href="#6-publish-a-native-executable-to-oracle-cloud-infrastructure" class="anchor_heading">#</a>
        
        
      </h2>
    
      <h3 id="61-publish-the-native-executable-to-container-registry">
        
        
          6.1. Publish the Native Executable to Container Registry <a href="#61-publish-the-native-executable-to-container-registry" class="anchor_heading">#</a>
        
        
      </h3>

<p>To create and publish a container image containing a native executable to Container Registry, provide the path to a container repository in the build file.</p>

<div id="tabs-doc5">
  <ul>
      <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
      <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <p>Modify the <em>oci/build.gradle</em> file. Make sure it contains the following contents and that nothing overrides the set properties:
      <pre><code class="language-java">var regionIdentifier = "[REGION IDENTIFIER]"
var objectStorageNamespace = "[OBJECT STORAGE NAMESPACE]"
tasks {
    dockerBuild {
        images = ["${regionIdentifier}.ocir.io/${objectStorageNamespace}/gdk-function-demo"]
    }
    dockerBuildNative {
        images = ["${regionIdentifier}.ocir.io/${objectStorageNamespace}/gdk-function-demo"]
    }
    dockerfile {
        baseImage('fnproject/fn-java-fdk:jre17-latest')
    }
    dockerfileNative {
        args("-XX:MaximumHeapSizePercent=80")
        baseImage('gcr.io/distroless/cc-debian10')
    }
}</code></pre>
      <ul>
        <li>Fill in the region identifier and object storage namespace as described in section <b>3.2</b>.</li>
        <li>Set the <code>dockerfile.baseImage</code> property to use the Java 17 runtime environment.</li>
        <li>Use a distroless base container image and limit the heap size to 80% for native executable.</li>
      </ul>
    </p>
    <p>
    Save the build file, then run the following command to create and publish a container image (of the native executable) to Container Registry:
    <pre><code class="language-bash">./gradlew oci:dockerPushNative</code></pre>
    </p>
  </div>
  <div id="maven">
    <p>Modify the <em>oci/pom.xml</em> file. Add the following profile:
      <pre><code class="language-xml">&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;docker-native&lt;/id&gt;
    &lt;activation&gt;
      &lt;property&gt;
        &lt;name&gt;packaging&lt;/name&gt;
        &lt;value&gt;docker-native&lt;/value&gt;
      &lt;/property&gt;
    &lt;/activation&gt;
    &lt;properties&gt;
      &lt;jib.docker.tag&gt;native&lt;/jib.docker.tag&gt;
      &lt;jib.docker.image&gt;${regionIdentifier}.ocir.io/${objectStorageNamespace}/gdk-function-demo&lt;/jib.docker.image&gt;
    &lt;/properties&gt;
    &lt;build&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;io.micronaut.build&lt;/groupId&gt;
          &lt;artifactId&gt;micronaut-maven-plugin&lt;/artifactId&gt;
          &lt;configuration&gt;
            &lt;baseImageRun&gt;gcr.io/distroless/cc-debian10&lt;/baseImageRun&gt;
            &lt;nativeImageBuildArgs&gt;
              &lt;arg&gt;--initialize-at-build-time=com.example&lt;/arg&gt;
            &lt;/nativeImageBuildArgs&gt;
          &lt;/configuration&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;
          &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;
          &lt;configuration&gt;
            &lt;to&gt;
              &lt;image&gt;${jib.docker.image}&lt;/image&gt;
            &lt;/to&gt;
          &lt;/configuration&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/build&gt;
  &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
    <ul>
      <li>Make sure that the region identifier and object storage namespace properties are set as described in section <b>3.2</b>.</li>
      <li>Use <code>&lt;jib.docker.image&gt;</code> to set the name of the container image created by the <code>docker-native</code> build command.</li>
      <li>Use <code>&lt;baseImageRun&gt;</code> to use a distroless base container image as the base runtime image.</li>
    </ul>
    </p>
    <p>
      Save the build file, then run the following commands to create and publish a container image (of the native executable) to Container Registry:
    </p>
    <pre><code class="language-bash">./mvnw clean
./mvnw install -pl lib -am
./mvnw deploy -Dpackaging=docker-native -pl oci</code></pre>
  </div>
</div>
    
      <h3 id="62-create-the-oracle-cloud-infrastructure-function">
        
        
          6.2. Create the Oracle Cloud Infrastructure Function <a href="#62-create-the-oracle-cloud-infrastructure-function" class="anchor_heading">#</a>
        
        
      </h3>

<p>To create a function on Oracle Functions with the native executable, repeat the steps in section <strong>3.2.</strong>, then set up an API gateway as described in section <strong>4</strong>.</p>

<p>Alternatively, you can open the existing application in Oracle Cloud Infrastructure, find the function that you created and click <strong>Edit</strong>. In the list, choose the native executable from the container registry and click <strong>Save</strong>. Once the function reloads, use the same API Gateway to access it and test it as described in section <strong>5</strong>.</p>
    
      <h3 id="summary">
        
        
          Summary <a href="#summary" class="anchor_heading">#</a>
        
        
      </h3>

<p>This guide demonstrated how to create a Micronaut Gateway Function application, run it on Oracle Functions, and set up an API Gateway to provide access to the function.</p>
    
      <h3 id="related-documentation">
        
        
          Related Documentation <a href="#related-documentation" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li><a href="https://micronaut-projects.github.io/micronaut-oracle-cloud/latest/guide/">Micronaut Oracle Cloud</a></li>
  <li><a href="https://docs.oracle.com/iaas/Content/APIGateway/Tasks/apigatewaycreatingpolicies.htm#usersfunctionspolicy">API Gateway: Create Policy to Give API Gateways Access to Functions</a>.</li>
  <li><a href="https://docs.oracle.com/iaas/developer-tutorials/tutorials/functions/func-api-gtw/01-summary.htm#setup-functions-dev">Oracle Functions: Call a Function using API Gateway</a></li>
  <li><a href="https://graalvm.github.io/native-build-tools/latest/index.html">Native Build Tools</a></li>
  <li><a href="https://www.graalvm.org/">GraalVM Native Image</a></li>
</ul>

      </div>

      <div role="button" class="menu-btn menu-btn--sidebar js-show-sidebar" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
    </div>
  </div>
</article>



</div>

      </main>

      
<footer class="footer footer__mobile">

  <div class="container-fluid container-fluid--custom-sm">
    <div class="row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <div class="row footer-content">
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">Learn</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/get-started/">Get Started</a></li>
                <li class="footer-list__item"><a href="/gdk/guides/">Guides</a></li>
                <li class="footer-list__item"><a href="/gdk/hands-on-labs/">Labs</a></li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/logo-github.svg" alt="Github icon">
                  <a href="https://github.com/oracle/graal-dev-kit" target="blank">Github</a>
                </li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/slack-icon.svg" alt="Github icon">
                  <a href="https://bit.ly/odevrel_slack" target="blank">#graal-dev-kit-for-micronaut</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">About</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/about/#gdk-support" target="blank">Commercial Support</a></li>
                <li class="footer-list__item"><a href="https://www.graalvm.org/" target="blank">GraalVM Native Image</a></li>
                <li class="footer-list__item"><a href="https://micronaut.io/" target="_blank">Micronaut<sup>&reg;</sup> Framework</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/multicloud/what-is-multicloud/" target="_blank">Multicloud</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/" target="blank">Oracle Cloud Infrastructure</a></li>
                <li class="footer-list__item"><a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.graal-cloud-native-pack" target="blank">VS Code Tools</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md-6 col-sm-12 aligning_1024">
            <div class="card--footer card--hovered box">
              <div>
                <div class="rubber-footer footer__oci-section">
                  <p class="title-footer quickstart">Build, test, and deploy applications on Oracle Cloud Infrastructure for free</p>
                  <a href="https://www.oracle.com/cloud/free/" target="_blank"
                    class="btn btn-primary">Try Oracle Cloud Infrastructure Free Tier</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
          <div class="row">
            <div class="col-sm-12">
              <p class="copyright">
                Copyright &copy; 2023-2024, Oracle and/or its affiliates.
                All rights reserved.
                Oracle and Java are registered trademarks of Oracle and/or its affiliates.<br/>
                Micronaut<sup>&reg;</sup> is a registered trademark of Object Computing, Inc.
                Use is for referential purposes and does not imply any endorsement or affiliation with any third-party product.
                Unauthorized use is strictly prohibited. Other names may be trademarks of their respective owners.
              </p>
              <div id="teconsent"></div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</footer>

<script>
  function fadeInAndOut(thz) {
    var elmt = thz.nextElementSibling;//Get the element that is below the button that
    //was just clicked
    if (elmt.clientHeight) {
      elmt.style.height = 0;
    } else {
      var wrapper = elmt.querySelector('ul');
      elmt.style.height = wrapper.clientHeight + "px";
    }
    /*
        elmt.classList.toggle("acordianPanelHidden");//Toggle the class which changes
        //attributes which triggers the transition CSS
        */
  }

  // Check TRUSTe Consent for Functional or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(2) != -1) ) {

      //The following is a sample of a Maxymiser Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript" src="//service.maxymiser.net/cdn/oracle/js/mmcore.js"><\/script>');
  }

  // Check TRUSTe Consent for Advertising or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(3) != -1) ) {

      //The following is a sample of a BlueKai Core Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript">' +
      'window.bk_async = function() { ' +
      'BKTAG.doTag(62581, 1); }; ' +
      '(function() { ' +
      'var scripts = document.getElementsByTagName(\'script\')[0]; ' +
      'var s = document.createElement(\'script\'); ' +
      's.async = true; ' +
      's.src = "https://tags.bkrtx.com/js/bk-coretag.js"; ' +
      'scripts.parentNode.insertBefore(s, scripts); ' +
      '}()); ' +
      '<\/script>');
  }
</script>

    </div>
    <div class="overlay"></div>

    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <script src='/gdk/resources/lib/slick-slider/slick.min.js'></script>
    <script src='/gdk/resources/js/main.js'></script>
    <script src='/gdk/resources/js/ui.js'></script>
    <script src='/gdk/resources/js/filters.js'></script>
    <script src='/gdk/resources/js/sidebar.js'></script>
    <script src='/gdk/resources/js/labs.js'></script>
    <script src='/gdk/resources/lib/highlight/highlight.min.js'></script>
    <script>hljs.highlightAll();</script>
  </body>
</html>
