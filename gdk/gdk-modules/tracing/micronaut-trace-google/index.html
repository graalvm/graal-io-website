<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/gdk/resources/img/graalvm.png" />
  <meta name="twitter:widgets:border-color" content="#55acee">

  <title>
    
      Create and Trace a Micronaut Application Using Google Cloud Trace
    
  </title>
  <meta name="description" content="The Graal Development Kit for Micronaut (GDK) is a build of a curated set of Micronaut framework modules and their required libraries for building portable c..."/>
  <meta name="last_modified" content="2024-06-28 09:44:14 +0000"/>
  <meta name="last_built" content="2024-07-16 15:01:39 +0000"/>
  <link rel="stylesheet" href="/gdk/assets/main.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/gdk/resources/img/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/gdk/resources/img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/gdk/resources/img/favicon/favicon-16x16.png">
  <link rel="manifest" href="/gdk/resources/img/favicon/site.webmanifest">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="-vRqwa9WYn6AaQGnl88xvrLw6ac4xoKVkZkhanmlRhU" />
  <link rel="canonical" href="https://www.graal.cloud/gdk/gdk-modules/tracing/micronaut-trace-google/">

  <!-- jQuery UI Tabs -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/gdk/resources/lib/jquery/jquery-ui.css">
</head>

      <script src="/gdk/resources/lib/jquery/jquery-3.6.1.min.js"></script>
    <script src="/gdk/resources/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src='/gdk/resources/lib/sticky-sidebar/resizeSensor.js'></script>
    <script src='/gdk/resources/lib/sticky-sidebar/sticky-sidebar.min.js'></script>
    <script src="/gdk/resources/lib/highlight/highlight.min.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Add TRUSTe Consent Script and Analytics -->
    <script async="async" type="text/javascript" src='//consent.trustarc.com/notice?domain=oracle.com&c=teconsent&js=bb&noticeType=bb&text=true&cdn=1&pcookie&gtm=1' crossorigin></script>
    <script src="https://www.oracle.com/assets/truste-oraclelib.js"></script>
    <!-- jQuery UI Tabs -->
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>


  <body class="preload">
    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <div  class="wrapper wrapper--nofooter" >

      <header  class="header header--content" 
  role="banner">

  

  

    <nav class="menu">
      <div class="menu__row">
        <div>
          <a href="/gdk/">
            <img class="logo-mobile" src="/gdk/resources/img/gdk-logo-new.svg" alt="Graal Development Kit for Micronaut logo">
          </a>
        </div>
        <div class="menu__container">
          <ul class="menu__list">
            <li class="menu__item">
              <a href="/gdk/about/" class="menu__link">About</a>
            </li>
            <li class="menu__item">
              <a href="/gdk/get-started/" class="menu__link">Get Started</a>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Docs</a>
                <div class="stack-menu-learn">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/modules.svg'>
                        <a href="/gdk/modules/" class="item-line">Modules</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/guides.svg'>
                        <a href="/gdk/guides/" class="item-line">Guides</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/labs.svg'>
                        <a href="/gdk/hands-on-labs/" class="item-line">Hands-On Labs</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/tools.svg'>
                        <a href="/gdk/vscode-tools/" class="item-line">Tools</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Graal Projects</a>
                <div class="stack-menu">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalstack.svg'>
                        <a href="https://graal.cloud/" class="item-line">Graal</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalvm.svg'>
                        <a href="https://graalvm.org/" class="item-line">GraalVM</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalos.svg'>
                        <a href="https://graal.cloud/graalos/" class="item-line">GraalOS</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__launch__mobile">
              <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
            </li>
          </ul>
        </div>
        <div class="menu__launch">
          <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
        </div>
      </div>

      <div role="button" class="menu-btn menu-btn--menu js-show-menu" tabindex="-1" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
      <button aria-label="hamburger mobile menu" class="btn btn-mobile-menu js-show-menu">
        <div class="inner"></div>
      </button>
    </nav>

  
</header>


      <main  class="content"   aria-label="Content">
        <div class="wrapper wrapper-content">
  <article>
  <div class="row d-flex flex-wrap">
    <div class="col-sm-3 docsimpro col-bg">
      <div class="sidebar-wrap">
        <div class="sidebar">
          <div class="menuabout">
            <img id="sidebarClose" src="/gdk/resources/img/arrow_sidebar(close).svg" alt="Expand or collapse sidebar"
              class="btn-color no-display">
            <img id="sidebarOpen" src="/gdk/resources/img/arrow_sidebar.svg" alt="Expand or collapse sidebar">
          </div>
          
<div class="toc-floating">


<div class="toc-bullets">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    

    
      
        
          <li class="toc-bullets-main">
        
          
          <a href="/gdk/docs/gdk-modules/tracing/" class="_icon-book">
            Tracing
          </a>
        </li>

        
        

        
        
          
          <li class="toc-bullets-sub toc-bullets-highlight">
          
            
            <a href="/gdk/gdk-modules/tracing/micronaut-trace-google/">
              Create and Trace a Micronaut Application Using Google Cloud Trace
            </a>
          </li>

          
            <div>
  <script>
    var scriptElement = document.currentScript;
    var div = $(scriptElement.parentElement);
    $(window).on("load", function () {
      $("#content-wrapper h2").each(function () {
        var li = $("<li></li>", { class: "toc-bullets-sub toc-bullets-sub-3" });
        var a = $("<a></a>", { href: "#" + $(this).attr("id") });
        a.text($(this).text().replace('#', ''));
        li.append(a);
        li.click(function (e) {
          e.preventDefault();
          var target = $(a.attr('href'));
          var scrollTo = target.offset().top - 80; // 80 - indent
          $('html, body').animate({ scrollTop: scrollTo }, 1000);
        });
        div.append(li);
      });
    });
  </script>
</div>
          
        
      
    
  

  

  

  

  

<!-- <li class="search additional-search">
  <form class="form-inline sidebar" action="/docs/search" autocomplete="on" method="get">
    <input class="input-search sidebar" type="text" id="search-box" name="query" placeholder="Search">
    <button type="submit sidebar" class="search-button"></button>
  </form>
</li> -->

</div>
  <!-- Search form -->
  <!-- <form class="search-container" action="/docs/search" autocomplete="on" method="get">
   <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <button type="submit" class="searchbttn"></button>
  </form> -->
</div>

        </div>
      </div>
    </div>

    <div class="col-sm-9 docsmod">
      <div id="content-wrapper" class="docs-content docs-content--with-sidebar">
        <!--
          Include file to warn of Windows/Gradle restriction
        -->
        <h1 id="create-and-trace-a-micronaut-application-using-google-cloud-trace">
        
        
          Create and Trace a Micronaut Application Using Google Cloud Trace
        
        
      </h1>

<p>This guide describes how to use the Graal Development Kit for Micronaut (GDK) to create and trace an application using <a href="https://cloud.google.com/trace">Google Cloud Trace</a>.</p>

<p>Tracing enables you to track service requests in a single or distributed application. Trace data shows the path, time spent in each section (called a <em>span</em>), and other information collected along during the trace.
Tracing gives you observability into what is causing bottlenecks and failures.</p>
    
      <h3 id="prerequisites">
        
        
          Prerequisites <a href="#prerequisites" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li>JDK 17 or higher. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>.</li>
  <li>A Google Cloud Platform (GCP) account. See <a href="/gdk/get-started/setting-up-cloud-accounts/">Setting up your Cloud Accounts</a>.</li>
  <li>The Google Cloud CLI. (The CLI is part of the Google Cloud SDK; for more information, see <a href="https://cloud.google.com/sdk">Cloud SDK</a>.)</li>
  <li>The GDK CLI. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>. (Optional.)</li>
</ul>

<blockquote>
  <p>Note: This guide uses paid services; you may need to <a href="https://cloud.google.com/billing/docs/how-to/modify-project">enable billing</a> in Google Cloud to complete some steps in this guide.</p>
</blockquote>

<p>Follow the steps below to create the application from scratch. However, you can also download the completed example:</p>

<div id="tabs-doc1">
  <ul>
    <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <p><a href="https://github.com/oracle/gcn/releases/download/4.5.0.0/4.5.0.0_tracing_gcp-tracing-demo-java-gradle.zip">Gradle GCP Tracing Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
  <div id="maven">
    <p><a href="https://github.com/oracle/gcn/releases/download/4.5.0.0/4.5.0.0_tracing_gcp-tracing-demo-java-maven.zip">Maven GCP Tracing Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
</div>
    
      <h4 id="a-note-regarding-your-development-environment">
        
        
          A note regarding your development environment
        
        
      </h4>

<p>Consider using Visual Studio Code, which provides native support for developing applications with the <a href="/gdk/vscode-tools/using-gdk-vscode-tools/">Graal Development Kit extension</a>.</p>

<blockquote>
  <p>Note: If you use IntelliJ IDEA, <a href="/gdk/resources/img/annotationprocessorsintellij.png">enable annotation processing</a>.</p>
</blockquote>

<blockquote>
  <p>Windows platform: The GDK guides are compatible with Gradle only. Maven support is coming soon.</p>
</blockquote>
    
      <h2 id="1-create-the-application">
        
        
          1. Create the Application <a href="#1-create-the-application" class="anchor_heading">#</a>
        
        
      </h2>

<p>Create an application using the GDK Launcher.</p>

<ol>
  <li>
    <p>Open the <a href="/gdk/launcher/?advanced=true">GDK Launcher in advanced mode</a>.</p>
  </li>
  <li>Create a new project using the following selections.
    <ul>
      <li><strong>Project Type</strong>: <em>Application</em> (default)</li>
      <li><strong>Project Name</strong>: <em>gcp-tracing-demo</em></li>
      <li><strong>Base Package</strong>: <em>com.example</em> (Default)</li>
      <li><strong>Clouds</strong>: <em>GCP</em></li>
      <li><strong>Language</strong>: <em>Java</em> (default)</li>
      <li><strong>Build Tool</strong>: <em>Gradle (Groovy)</em> or <em>Maven</em></li>
      <li><strong>Test Framework</strong>: <em>JUnit</em> (default)</li>
      <li><strong>Java Version</strong>: <em>17</em> (default)</li>
      <li><strong>Micronaut Version</strong>: (default)</li>
      <li><strong>Cloud Services</strong>: <em>Tracing</em></li>
      <li><strong>Features</strong>: <em>GraalVM Native Image</em> (Default)</li>
      <li><strong>Sample Code</strong>: <em>No</em></li>
    </ul>
  </li>
  <li>Click <strong>Generate Project</strong>, then click <strong>Download Zip</strong>. The GDK Launcher creates an application with the default package <code>com.example</code> in a directory named <em>gcp-tracing-demo</em>. The application ZIP file will be downloaded to your default downloads directory. Unzip it, open it in your code editor, and proceed to the next steps.</li>
</ol>

<p>Alternatively, use the GDK CLI as follows:</p>

<div id="tabs-doc2">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">
        <pre><code class="language-bash">gdk create-app com.example.gcp-tracing-demo \
    --clouds=gcp \
    --services=tracing \
    --features=graalvm \
    --example-code=false \
    --build=gradle \
    --jdk=17 \
    --lang=java</code></pre>
    </div>
    <div id="maven">
        <pre><code class="language-bash">gdk create-app com.example.gcp-tracing-demo \
    --clouds=gcp \
    --services=tracing \
    --features=graalvm \
    --example-code=false \
    --build=maven \
    --jdk=17 \
    --lang=java</code></pre>
    </div>
</div>

<p>For more information, see <a href="/gdk/get-started/using-gdk-cli/">Using the GDK CLI</a>.</p>
    
      <h3 id="11-tracing-annotations">
        
        
          1.1. Tracing Annotations <a href="#11-tracing-annotations" class="anchor_heading">#</a>
        
        
      </h3>

<p>The Micronaut framework uses the <a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/package-summary.html"><code>io.micronaut.tracing.annotation</code></a> package and <a href="https://opentelemetry.io/">OpenTelemetry</a> to generate and export tracing data.</p>

<p>The <code>io.micronaut.tracing.annotation</code> package provides the following three annotations:</p>

<ul>
  <li>
    <p><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/NewSpan.html"><code>@NewSpan</code></a>: Used on methods to create a new span; defaults to the <em>method</em> name, but you can assign a unique name instead.</p>
  </li>
  <li>
    <p><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/ContinueSpan.html"><code>@ContinueSpan</code></a>: Used on methods to continue an existing span; primarily used in conjunction with <code>@SpanTag</code> (below).</p>
  </li>
  <li>
    <p><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/api/io/micronaut/tracing/annotation/SpanTag.html"><code>@SpanTag</code></a>: Used on method parameters to assign a value to a span; defaults to the <em>parameter</em> name, but you can assign a unique name instead. To use the <code>@SpanTag</code> on a method parameter, the method must be annotated with either <code>@NewSpan</code> or <code>@ContinueSpan</code>.</p>
  </li>
</ul>

<p>Your build configuration file contains the <code>io.micronaut.tracing</code> dependency which means all HTTP server methods (those annotated with <code>@Get</code>, <code>@Post</code>, and so on) create spans automatically.</p>
    
      <h3 id="12-inventoryservice">
        
        
          1.2. InventoryService <a href="#12-inventoryservice" class="anchor_heading">#</a>
        
        
      </h3>

<blockquote>
  <p>Note: The <code>InventoryService</code> class demonstrates how to create and use spans from <code>io.micronaut.tracing.annotation</code> and OpenTelemetry.</p>
</blockquote>

<p>The GDK Launcher created the <code>InventoryService</code> class in a file named <em>lib/src/main/java/com/example/InventoryService.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.tracing.annotation.NewSpan;
import io.micronaut.tracing.annotation.SpanTag;
import io.opentelemetry.api.trace.Span;
import io.opentelemetry.api.trace.Tracer;
import jakarta.inject.Singleton;

import java.util.Collection;
import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

@Singleton
public class InventoryService {

    private static final String storeName = "my_store";

    private final Tracer tracer;
    private final WarehouseClient warehouse;
    private final Map&lt;String, Integer&gt; inventory = new ConcurrentHashMap&lt;&gt;();

    InventoryService(Tracer tracer, WarehouseClient warehouse) { // &lt;1&gt;
        this.tracer = tracer;
        this.warehouse = warehouse;

        inventory.put("laptop", 4);
        inventory.put("desktop", 2);
        inventory.put("monitor", 11);
    }

    public Collection&lt;String&gt; getProductNames() {
        return inventory.keySet();
    }

    @NewSpan("stock-counts") // &lt;2&gt;
    public Map&lt;String, Integer&gt; getStockCounts(@SpanTag("inventory.item") String item) { // &lt;3&gt;
        Map&lt;String, Integer&gt; counts = new HashMap&lt;&gt;();
        if (inventory.containsKey(item)) {
            int count = inventory.get(item);
            counts.put("store", count);

            if (count &lt; 10) {
                counts.put("warehouse", inWarehouse(storeName, item));
            }
        }

        return counts;
    }

    private int inWarehouse(String store, String item) {
        Span.current().setAttribute("inventory.store-name", store); // &lt;4&gt;

        return warehouse.getItemCount(store, getUPC(item));
    }

    public void order(String item, int count) {
        orderFromWarehouse(item, count);
        if (inventory.containsKey(item)) {
            count += inventory.get(item);
        }
        inventory.put(item, count);
    }

    private void orderFromWarehouse(String item, int count) {
        Span span = tracer.spanBuilder("warehouse-order") // &lt;5&gt;
                .setAttribute("item", item)
                .setAttribute("count", count)
                .startSpan();

        warehouse.order(Map.of(
                "store", storeName,
                "product", item,
                "amount", count,
                "upc", getUPC(item)));

        span.end(); // &lt;6&gt;
    }

    private int getUPC(String item) {
        return Math.abs(item.hashCode());
    }
}
</code></pre>
<p><strong>1</strong> Inject an OpenTelemetry Tracing bean into the class.</p>

<p><strong>2</strong> Create a new <code>io.micronaut.tracing.annotation</code> span called “stock-counts”.</p>

<p><strong>3</strong> Add a <code>io.micronaut.tracing.annotation</code> tag called “inventory.item” that will contain the value contained in the parameter <code>item</code>.</p>

<p><strong>4</strong> Get the current OpenTelemetry span and set the value of its attribute named “inventory.store-name” to the <code>store</code> parameter.</p>

<p><strong>5</strong> Create an OpenTelemetry span named “warehouse-order”, set its attributes and start the span.</p>

<p><strong>6</strong> End the span started in <strong>5</strong>.</p>
    
      <h3 id="13-store-controller">
        
        
          1.3. Store Controller <a href="#13-store-controller" class="anchor_heading">#</a>
        
        
      </h3>

<p>The GDK Launcher created the <code>StoreController</code> class in a file named <em>lib/src/main/java/com/example/StoreController.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.annotation.Status;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;
import io.micronaut.tracing.annotation.ContinueSpan;
import io.micronaut.tracing.annotation.NewSpan;
import io.micronaut.tracing.annotation.SpanTag;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static io.micronaut.http.HttpStatus.CREATED;

@ExecuteOn(TaskExecutors.IO)
@Controller("/store")
class StoreController {

    private final InventoryService inventory;

    StoreController(InventoryService inventory) {
        this.inventory = inventory;
    }

    @Post("/order")
    @Status(CREATED)
    @NewSpan("store.order") // &lt;1&gt;
    void order(@SpanTag("order.item") String item, @SpanTag int count) { // &lt;2&gt;
        inventory.order(item, count);
    }

    @Get("/inventory") // &lt;3&gt;
    List&lt;Map&lt;String, Object&gt;&gt; getInventory() {
        return inventory.getProductNames().stream()
                .map(this::getInventory)
                .collect(Collectors.toList());
    }

    @Get("/inventory/{item}")
    @ContinueSpan // &lt;4&gt;
    Map&lt;String, Object&gt; getInventory(@SpanTag("item") String item) { // &lt;5&gt;
        Map&lt;String, Object&gt; counts = new HashMap&lt;&gt;(inventory.getStockCounts(item));
        if (counts.isEmpty()) {
            counts.put("note", "Not available at store");
        }

        counts.put("item", item);

        return counts;
    }
}
</code></pre>

<p><strong>1</strong> Create a new span called “store.order”.</p>

<p><strong>2</strong> Add tags for the method parameters. Name the first parameter “order.item”, and use the default name for the second parameter.</p>

<p><strong>3</strong> A span is created automatically if your build configuration file contains the <code>io.micronaut.tracing</code> dependency.</p>

<p><strong>4</strong> Required for <code>@SpanTag</code> (see <strong>5</strong>).</p>

<p><strong>5</strong> Add a tag for the method parameter.</p>
    
      <h3 id="14-warehouse-client">
        
        
          1.4. Warehouse Client <a href="#14-warehouse-client" class="anchor_heading">#</a>
        
        
      </h3>

<p>The GDK Launcher created the <code>WarehouseClient</code> class in a file named <em>lib/src/main/java/com/example/WarehouseClient.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.annotation.QueryValue;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.tracing.annotation.ContinueSpan;
import io.micronaut.tracing.annotation.NewSpan;
import io.micronaut.tracing.annotation.SpanTag;

import java.util.Map;

@Client("/warehouse") // &lt;1&gt;
public interface WarehouseClient {

    @Post("/order")
    @NewSpan
    void order(@SpanTag("warehouse.order") Map&lt;String, ?&gt; json);

    @Get("/count")
    @ContinueSpan
    int getItemCount(@QueryValue String store,
                     @SpanTag @QueryValue int upc);
}
</code></pre>

<p><strong>1</strong> Some external service without tracing.</p>
    
      <h3 id="15-warehouse-controller">
        
        
          1.5. Warehouse Controller <a href="#15-warehouse-controller" class="anchor_heading">#</a>
        
        
      </h3>

<p>The GDK Launcher created a <code>WarehouseController</code> class to represent an external service that will be called by <code>WarehouseClient</code> in a file named <em>lib/src/main/java/com/example/WarehouseController.java</em>, as follows:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.scheduling.TaskExecutors;
import io.micronaut.scheduling.annotation.ExecuteOn;

import java.util.Random;

@ExecuteOn(TaskExecutors.IO) //&lt;1&gt;
@Controller("/warehouse") // &lt;2&gt;
class WarehouseController {

    @Get("/count") // &lt;3&gt;
    HttpResponse&lt;?&gt; getItemCount() {
        return HttpResponse.ok(new Random().nextInt(11));
    }

    @Post("/order") // &lt;4&gt;
    HttpResponse&lt;?&gt; order() {
        try {
            //To simulate an external process taking time
            Thread.sleep(500);
        } catch (InterruptedException ignored) {
        }

        return HttpResponse.accepted();
    }
}
</code></pre>
<p><strong>1</strong> It is critical that any blocking I/O operations (such as fetching the data from the database) are offloaded to a separate thread pool that does not block the event loop.</p>

<p><strong>2</strong> The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html"><code>@Controller</code></a> annotation mapped to the path <code>/warehouse</code>.</p>

<p><strong>3</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html"><code>@Get</code></a> annotation maps the <code>getItemCount</code> method to an HTTP GET request on <code>/warehouse/count</code>.</p>

<p><strong>4</strong> The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html"><code>@Get</code></a> annotation maps the <code>order</code> method to an HTTP GET request on <code>/warehouse/order</code>.</p>
    
      <h3 id="16-configure-tracer">
        
        
          1.6. Configure Tracer <a href="#16-configure-tracer" class="anchor_heading">#</a>
        
        
      </h3>

<p>When you created your application, the GDK Launcher automatically added the necessary OpenTelemetry configuration to your <em>gcp/src/main/resources/application.properties</em> file, as shown below:</p>

<pre><code>otel.traces.exporter=google_cloud_trace
</code></pre>
    
      <h2 id="2-create-a-new-gcp-project">
        
        
          2. Create a New GCP Project <a href="#2-create-a-new-gcp-project" class="anchor_heading">#</a>
        
        
      </h2>

<p>Create a new GCP project named “gdk-guides” (follow the instructions contained in <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">Creating and managing projects</a>).</p>

<ol>
  <li>Log in to the Google Cloud Platform:
    <pre><code class="language-bash"> gcloud auth login
</code></pre>
  </li>
  <li>Change your project:
    <pre><code class="language-bash"> gcloud config set project gdk-guides
</code></pre>
  </li>
</ol>
    
      <h2 id="3-run-the-application">
        
        
          3. Run the Application <a href="#3-run-the-application" class="anchor_heading">#</a>
        
        
      </h2>

<p>The application can be deployed to Google Cloud Run, Cloud Function, Cloud Compute, or App Engine.
Traces can be sent to Google Cloud Trace outside the Google Cloud.
This enables you to run the application locally and view the traces in Google Cloud Trace.</p>

<p>To run the application, use the following command, which starts the application on port 8080.</p>

<div id="tabs-doc3">
    <ul>
        <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
        <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
    </ul>
    <div id="gradle">
        <pre><code class="language-bash">./gradlew :gcp:run</code></pre>
    </div>
    <div id="maven">
        <pre><code class="language-bash">./mvnw install -pl lib -am
./mvnw mn:run -pl gcp</code></pre>
    </div>
</div>

<p>You might get this error message when running your application:
“Message: The Application Default Credentials are not available. They are available if running in Google Compute Engine. Otherwise, the environment variable GOOGLE_APPLICATION_CREDENTIALS must be defined pointing to a file defining the credentials. See <a href="https://developers.google.com/accounts/docs/application-default-credentials">https://developers.google.com/accounts/docs/application-default-credentials</a> for more information.”</p>

<p>If you are developing locally you can run the following command:</p>
<pre><code class="language-bash">gcloud auth application-default login
</code></pre>

<p>However, Google strongly recommends that you set up a service account. Follow the instructions in the <a href="https://developers.google.com/accounts/docs/application-default-credentials">link above</a> and <a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/#setup">Micronaut GCP setup instructions</a> to create and configure a service account.</p>
    
      <h2 id="4-test-the-application">
        
        
          4. Test the Application <a href="#4-test-the-application" class="anchor_heading">#</a>
        
        
      </h2>

<p>Test the application by accessing REST endpoints. Then review the trace output.</p>

<p>Open the <a href="https://console.cloud.google.com/traces">GCP Tracing Console</a>.</p>

<p><img src="/gdk/docs/gdk-modules/tracing/images/trace-list-graph.png" alt="trace list graph" /></p>

<p>It may take a few seconds for the traces to be displayed.</p>
    
      <h3 id="41-get-item-counts">
        
        
          4.1. Get Item Counts <a href="#41-get-item-counts" class="anchor_heading">#</a>
        
        
      </h3>

<p>Send an HTTP GET request to the <code>/store/inventory/{item}</code> endpoint to get the count of an item, for example:</p>
<pre><code class="language-bash">curl http://localhost:8080/store/inventory/laptop
</code></pre>

<p><img src="/gdk/docs/gdk-modules/tracing/images/gcp-inventory-item.png" alt="inventory item" /></p>

<p>Each span is represented by a blue bar.</p>
    
      <h3 id="42-order-items">
        
        
          4.2. Order Items <a href="#42-order-items" class="anchor_heading">#</a>
        
        
      </h3>

<p>Send an HTTP POST request to the <code>/store/order</code> endpoint to order an item, as follows:</p>

<pre><code class="language-bash">curl -X "POST" "http://localhost:8080/store/order" \
    -H 'Content-Type: application/json; charset=utf-8' \
    -d $'{"item":"laptop", "count":5}'
</code></pre>

<p><img src="/gdk/docs/gdk-modules/tracing/images/gcp-order-item.png" alt="order item" /></p>

<p>Selecting a different span will show you the labels (also known as attributes/tags) and other details of the span.</p>
    
      <h3 id="43-get-inventory">
        
        
          4.3. Get Inventory <a href="#43-get-inventory" class="anchor_heading">#</a>
        
        
      </h3>

<p>Send an HTTP GET request to the <code>/store/inventory</code> endpoint to get the inventory:</p>

<pre><code class="language-bash">curl http://localhost:8080/store/inventory
</code></pre>

<p><img src="/gdk/docs/gdk-modules/tracing/images/gcp-inventory-all.png" alt="inventory all" /></p>

<p>Looking at the trace, you may conclude that retrieving the items sequentially might not be the best design choice.</p>
    
      <h2 id="5-generate-a-native-executable-using-graalvm">
        
        
          5. Generate a Native Executable Using GraalVM <a href="#5-generate-a-native-executable-using-graalvm" class="anchor_heading">#</a>
        
        
      </h2>

<p>The GDK supports compiling a Java application ahead-of-time into a native executable using <a href="https://www.graalvm.org/">GraalVM Native Image</a>. You can use the <em><a href="https://graalvm.github.io/native-build-tools/latest/gradle-plugin.html">Gradle plugin for GraalVM Native Image building</a>/<a href="https://graalvm.github.io/native-build-tools/latest/maven-plugin.html">Maven plugin for GraalVM Native Image building</a></em>. Packaged as a native executable, it significantly reduces application startup time and memory footprint.</p>

<p>To generate a native executable, run the following command:</p>

<div id="tabs-doc4">
  <ul>
    <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <pre><code class="language-bash">./gradlew :gcp:nativeCompile</code></pre>
  </div>
  <div id="maven">
    <pre><code class="language-bash">./mvnw install -pl lib -am
./mvnw package -pl gcp -Dpackaging=native-image</code></pre>
  </div>
</div>
    
      <h2 id="6-run-and-test-the-native-executable">
        
        
          6. Run and Test the Native Executable <a href="#6-run-and-test-the-native-executable" class="anchor_heading">#</a>
        
        
      </h2>

<p>Run the native executable, using the option <code>-Dmicronaut.application.name</code> to set the name of the application as “gcp-native-demo”, as follows:</p>

<div id="tabs-doc5">
  <ul>
    <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <pre><code class="language-bash">gcp/build/native/nativeCompile/gcp -Dmicronaut.application.name=gcp-native-demo</code></pre>
  </div>
  <div id="maven">
    <pre><code class="language-bash">gcp/target/gcp -Dmicronaut.application.name=gcp-native-demo</code></pre>
  </div>
</div>

<p>The native executable starts instantaneously.</p>
    
      <h3 id="61-get-item-counts">
        
        
          6.1. Get Item Counts <a href="#61-get-item-counts" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>Repeat the test from step <strong>4.1</strong> by sending an HTTP GET request to the <code>/store/inventory/{item}</code> endpoint to get the count of an item:</p>

    <pre><code class="language-bash"> curl http://localhost:8080/store/inventory/laptop
</code></pre>
  </li>
  <li>
    <p>Review the trace output in Trace Explorer: you should see a new row in the list of Traces that represents the request from the native executable:</p>

    <p>Notice that the native executable requests are processed a lot faster than its original.</p>
  </li>
  <li>
    <p>Click the trace name to view its details. Each span is represented by a blue bar.</p>
  </li>
</ol>
    
      <h3 id="62-order-items">
        
        
          6.2. Order Items <a href="#62-order-items" class="anchor_heading">#</a>
        
        
      </h3>

<ol>
  <li>
    <p>Repeat the test from step <strong>4.2</strong> by sending an HTTP POST request to the <code>/store/order</code> endpoint to order an item:</p>

    <pre><code class="language-bash"> curl -X "POST" "http://localhost:8080/store/order" \
     -H 'Content-Type: application/json; charset=utf-8' \
     -d $'{"item":"laptop", "count":5}'
</code></pre>

    <p>You should see a new row in the Trace Explorer that represents the POST request.</p>
  </li>
  <li>
    <p>Click the most recent trace name to view its details.</p>
  </li>
  <li>
    <p>Click the span named <code>gcp-native-demo: StoreController.order#store.order</code> to view its details showing the custom span attributes: <code>count</code> and <code>order.item</code>.</p>
  </li>
</ol>
    
      <h2 id="7-clean-up">
        
        
          7. Clean Up <a href="#7-clean-up" class="anchor_heading">#</a>
        
        
      </h2>

<p>When you have completed the guide, you can clean up the resources you created on Google Cloud Platform so you will not be billed for them in the future.</p>
    
      <h3 id="71-delete-the-project">
        
        
          7.1. Delete the Project <a href="#71-delete-the-project" class="anchor_heading">#</a>
        
        
      </h3>

<p>The easiest way to eliminate billing is to delete the project you created.</p>

<p>Deleting a project has the following consequences:</p>

<ul>
  <li>
    <p>If you used an existing project, you will also delete any other work you have done in the project.</p>
  </li>
  <li>
    <p>You cannot reuse the project ID of a deleted project. If you created a custom project ID that you plan to use in the future, you should delete the resources inside the project instead. This ensures that URLs that use the project ID, such as an <em>appspot.com</em> URL, remain available.</p>
  </li>
  <li>
    <p>If you are exploring multiple guides, reusing projects instead of deleting them prevents you from exceeding project quota limits.</p>
  </li>
</ul>
    
      <h4 id="711-via-the-cli">
        
        
          7.1.1. Via the CLI
        
        
      </h4>
<p>To delete the project using the Google Cloud CLI, run the following command:</p>

<pre><code class="language-bash">gcloud projects delete gdk-guides
</code></pre>
    
      <h4 id="712-via-the-cloud-platform-console">
        
        
          7.1.2. Via the Cloud Platform Console
        
        
      </h4>

<ol>
  <li>
    <p>In the Cloud Platform Console, go to the <a href="https://console.cloud.google.com/iam-admin/projects">Projects page</a>.</p>
  </li>
  <li>
    <p>In the project list, select the project you want to delete and click <strong>Delete project</strong>. Select the check box next to the project name and click <strong>Delete project</strong>.</p>
  </li>
  <li>
    <p>In the dialog box, enter the project ID, and then click <strong>Shut down</strong> to delete the project.</p>
  </li>
</ol>
    
      <h3 id="summary">
        
        
          Summary <a href="#summary" class="anchor_heading">#</a>
        
        
      </h3>

<p>This guide demonstrated how to create and trace a Micronaut application using <a href="https://cloud.google.com/trace">Google Cloud Trace</a>.</p>
    
      <h3 id="related-documentation">
        
        
          Related Documentation <a href="#related-documentation" class="anchor_heading">#</a>
        
        
      </h3>
<ul>
  <li><a href="https://micronaut-projects.github.io/micronaut-tracing/latest/guide/">Micronaut Tracing</a></li>
  <li><a href="https://micronaut-projects.github.io/micronaut-gcp/latest/guide/">Micronaut GCP integration</a></li>
  <li><a href="https://www.graalvm.org/">GraalVM Native Image</a></li>
  <li><a href="https://graalvm.github.io/native-build-tools/latest/index.html">Native Build Tools</a></li>
</ul>

      </div>

      <div role="button" class="menu-btn menu-btn--sidebar js-show-sidebar" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
    </div>
  </div>
</article>



</div>

      </main>

      
<footer class="footer footer__mobile">

  <div class="container-fluid container-fluid--custom-sm">
    <div class="row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <div class="row footer-content">
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">Learn</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/get-started/">Get Started</a></li>
                <li class="footer-list__item"><a href="/gdk/guides/">Guides</a></li>
                <li class="footer-list__item"><a href="/gdk/hands-on-labs/">Labs</a></li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/logo-github.svg" alt="Github icon">
                  <a href="https://github.com/oracle/graal-dev-kit" target="blank">Github</a>
                </li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/slack-icon.svg" alt="Github icon">
                  <a href="https://bit.ly/odevrel_slack" target="blank">#graal-dev-kit-for-micronaut</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">About</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/about/#gdk-support" target="blank">Commercial Support</a></li>
                <li class="footer-list__item"><a href="https://www.graalvm.org/" target="blank">GraalVM Native Image</a></li>
                <li class="footer-list__item"><a href="https://micronaut.io/" target="_blank">Micronaut<sup>&reg;</sup> Framework</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/multicloud/what-is-multicloud/" target="_blank">Multicloud</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/" target="blank">Oracle Cloud Infrastructure</a></li>
                <li class="footer-list__item"><a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.graal-cloud-native-pack" target="blank">VS Code Tools</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md-6 col-sm-12 aligning_1024">
            <div class="card--footer card--hovered box">
              <div>
                <div class="rubber-footer footer__oci-section">
                  <p class="title-footer quickstart">Build, test, and deploy applications on Oracle Cloud Infrastructure for free</p>
                  <a href="https://www.oracle.com/cloud/free/" target="_blank"
                    class="btn btn-primary">Try Oracle Cloud Infrastructure Free Tier</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
          <div class="row">
            <div class="col-sm-12">
              <p class="copyright">
                Copyright &copy; 2023-2024, Oracle and/or its affiliates.
                All rights reserved.
                Oracle and Java are registered trademarks of Oracle and/or its affiliates.<br/>
                Micronaut<sup>&reg;</sup> is a registered trademark of Object Computing, Inc. 
                Use is for referential purposes and does not imply any endorsement or affiliation with any third-party product.
                Unauthorized use is strictly prohibited. Other names may be trademarks of their respective owners.
              </p>
              <div id="teconsent"></div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</footer>

<script>
  function fadeInAndOut(thz) {
    var elmt = thz.nextElementSibling;//Get the element that is below the button that
    //was just clicked
    if (elmt.clientHeight) {
      elmt.style.height = 0;
    } else {
      var wrapper = elmt.querySelector('ul');
      elmt.style.height = wrapper.clientHeight + "px";
    }
    /*
        elmt.classList.toggle("acordianPanelHidden");//Toggle the class which changes
        //attributes which triggers the transition CSS
        */
  }

  // Check TRUSTe Consent for Functional or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(2) != -1) ) {

      //The following is a sample of a Maxymiser Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript" src="//service.maxymiser.net/cdn/oracle/js/mmcore.js"><\/script>');
  }

  // Check TRUSTe Consent for Advertising or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(3) != -1) ) {

      //The following is a sample of a BlueKai Core Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript">' +
      'window.bk_async = function() { ' +
      'BKTAG.doTag(62581, 1); }; ' +
      '(function() { ' +
      'var scripts = document.getElementsByTagName(\'script\')[0]; ' +
      'var s = document.createElement(\'script\'); ' +
      's.async = true; ' +
      's.src = "https://tags.bkrtx.com/js/bk-coretag.js"; ' +
      'scripts.parentNode.insertBefore(s, scripts); ' +
      '}()); ' +
      '<\/script>');
  }
</script>

    </div>
    <div class="overlay"></div>

    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <script src='/gdk/resources/lib/slick-slider/slick.min.js'></script>
    <script src='/gdk/resources/js/main.js'></script>
    <script src='/gdk/resources/js/ui.js'></script>
    <script src='/gdk/resources/js/filters.js'></script>
    <script src='/gdk/resources/js/sidebar.js'></script>
    <script src='/gdk/resources/js/labs.js'></script>
    <script src='/gdk/resources/lib/highlight/highlight.min.js'></script> 
    <script>hljs.highlightAll();</script>
  </body>
</html>
