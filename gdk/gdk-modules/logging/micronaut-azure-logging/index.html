<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:image" content="/gdk/resources/img/graalvm.png" />
  <meta name="twitter:widgets:border-color" content="#55acee">

  <title>
    
      Publish Application Logs to Azure Monitor Logs
    
  </title>
  <meta name="description" content="The Graal Development Kit for Micronaut (GDK) is a build of a curated set of Micronaut framework modules and their required libraries for building portable c..."/>
  <meta name="last_modified" content="2024-09-25 16:23:53 +0000"/>
  <meta name="last_built" content="2024-11-27 17:11:00 +0000"/>
  <link rel="stylesheet" href="/gdk/assets/main.css">
  <link rel="apple-touch-icon" sizes="180x180" href="/gdk/resources/img/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/gdk/resources/img/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/gdk/resources/img/favicon/favicon-16x16.png">
  <link rel="manifest" href="/gdk/resources/img/favicon/site.webmanifest">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="-vRqwa9WYn6AaQGnl88xvrLw6ac4xoKVkZkhanmlRhU" />
  <link rel="canonical" href="https://www.graal.cloud/gdk/gdk-modules/logging/micronaut-azure-logging/">

  <!-- jQuery UI Tabs -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.14.0/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/gdk/resources/lib/jquery/jquery-ui.css">
</head>

      <script src="/gdk/resources/lib/jquery/jquery-3.7.1.min.js"></script>
    <script src="/gdk/resources/lib/bootstrap/js/bootstrap.min.js"></script>
    <script src='/gdk/resources/lib/sticky-sidebar/resizeSensor.js'></script>
    <script src='/gdk/resources/lib/sticky-sidebar/sticky-sidebar.min.js'></script>
    <script src="/gdk/resources/lib/highlight/highlight.min.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Add TRUSTe Consent Script and Analytics -->
    <script async="async" type="text/javascript" src='//consent.trustarc.com/notice?domain=oracle.com&c=teconsent&js=bb&noticeType=bb&text=true&cdn=1&pcookie&gtm=1' crossorigin></script>
    <script src="https://www.oracle.com/assets/truste-oraclelib.js"></script>
    <!-- jQuery UI Tabs -->
    <script src="https://code.jquery.com/ui/1.14.0/jquery-ui.js"></script>


  <body class="preload">
    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <div  class="wrapper wrapper--nofooter" >

      <header  class="header header--content" 
  role="banner">

  

  

    <nav class="menu">
      <div class="menu__row">
        <div>
          <a href="/gdk/">
            <img class="logo-mobile" src="/gdk/resources/img/gdk-logo-new.svg" alt="Graal Development Kit for Micronaut logo">
          </a>
        </div>
        <div class="menu__container">
          <ul class="menu__list">
            <li class="menu__item">
              <a href="/gdk/about/" class="menu__link">About</a>
            </li>
            <li class="menu__item">
              <a href="/gdk/get-started/" class="menu__link">Get Started</a>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Docs</a>
                <div class="stack-menu-learn">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/modules.svg'>
                        <a href="/gdk/modules/" class="item-line">Modules</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/guides.svg'>
                        <a href="/gdk/guides/" class="item-line">Guides</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/labs.svg'>
                        <a href="/gdk/hands-on-labs/" class="item-line">Hands-On Labs</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/tools.svg'>
                        <a href="/gdk/vscode-tools/" class="item-line">Tools</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__item">
              <div class="stack-container">
                <a href="#" class="menu__link stack__header">Graal Projects</a>
                <div class="stack-menu">
                  <div class="stack-row">
                    <div class="stack-column">
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalstack.svg'>
                        <a href="https://graal.cloud/" class="item-line">Graal</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalvm.svg'>
                        <a href="https://graalvm.org/" class="item-line">GraalVM</a>
                      </div>
                      <div class="stack__item">
                        <img src='/gdk/resources/img/header-navigation/graalos.svg'>
                        <a href="https://graal.cloud/graalos/" class="item-line">GraalOS</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </li>
            <li class="menu__launch__mobile">
              <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
            </li>
          </ul>
        </div>
        <div class="menu__launch">
          <a href="/gdk/launcher/" class="btn-launch btn btn-primary" target="blank">Create App</a>
        </div>
      </div>

      <div role="button" class="menu-btn menu-btn--menu js-show-menu" tabindex="-1" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
      <button aria-label="hamburger mobile menu" class="btn btn-mobile-menu js-show-menu">
        <div class="inner"></div>
      </button>
    </nav>

  
</header>


      <main  class="content"   aria-label="Content">
        <div class="wrapper wrapper-content">
  <article>
  <div class="row d-flex flex-wrap">
    <div class="col-sm-3 docsimpro col-bg">
      <div class="sidebar-wrap">
        <div class="sidebar">
          <div class="menuabout">
            <img id="sidebarClose" src="/gdk/resources/img/arrow_sidebar(close).svg" alt="Expand or collapse sidebar"
              class="btn-color no-display">
            <img id="sidebarOpen" src="/gdk/resources/img/arrow_sidebar.svg" alt="Expand or collapse sidebar">
          </div>
          
<div class="toc-floating">


<div class="toc-bullets">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    

    
      
        
          <li class="toc-bullets-main">
        
          
          <a href="/gdk/docs/gdk-modules/logging/" class="_icon-book">
            Logging
          </a>
        </li>

        
        

        
        
          
          <li class="toc-bullets-sub toc-bullets-highlight">
          
            
            <a href="/gdk/gdk-modules/logging/micronaut-azure-logging/">
              Publish Application Logs to Azure Monitor Logs
            </a>
          </li>

          
            <div>
  <script>
    var scriptElement = document.currentScript;
    var div = $(scriptElement.parentElement);
    $(window).on("load", function () {
      $("#content-wrapper h2").each(function () {
        var li = $("<li></li>", { class: "toc-bullets-sub toc-bullets-sub-3" });
        var a = $("<a></a>", { href: "#" + $(this).attr("id") });
        a.text($(this).text().replace('#', ''));
        li.append(a);
        li.click(function (e) {
          e.preventDefault();
          var target = $(a.attr('href'));
          var scrollTo = target.offset().top - 80; // 80 - indent
          $('html, body').animate({ scrollTop: scrollTo }, 1000);
        });
        div.append(li);
      });
    });
  </script>
</div>
          
        
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

<!-- <li class="search additional-search">
  <form class="form-inline sidebar" action="/docs/search" autocomplete="on" method="get">
    <input class="input-search sidebar" type="text" id="search-box" name="query" placeholder="Search">
    <button type="submit sidebar" class="search-button"></button>
  </form>
</li> -->

</div>
  <!-- Search form -->
  <!-- <form class="search-container" action="/docs/search" autocomplete="on" method="get">
   <label for="search-box">Search</label>
    <input type="text" id="search-box" name="query">
    <button type="submit" class="searchbttn"></button>
  </form> -->
</div>

        </div>
      </div>
    </div>

    <div class="col-sm-9 docsmod">
      <div id="content-wrapper" class="docs-content docs-content--with-sidebar">
        <!--
          Include file to warn of Windows/Gradle restriction
        -->
        <h1 id="publish-application-logs-to-azure-monitor-logs">
        
        
          Publish Application Logs to Azure Monitor Logs
        
        
      </h1>

<p>This guide describes how to use the Graal Development Kit for Micronaut (GDK) to create an application that publishes logs to <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/data-platform-logs" target="_blank">Azure Monitor Logs</a>. Typically, application logs are written to <code>stdout</code> and to files, but the Micronaut<sup>®</sup> Logging module supports multiple logging frameworks such as <a href="https://logback.qos.ch/" target="_blank">Logback</a>, and logging to various other appenders, to email, a database, or other destinations.</p>
    
      <h3 id="prerequisites">
        
        
          Prerequisites <a href="#prerequisites" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li>JDK 17 or higher. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>.</li>
  <li>An Azure account. See <a href="/gdk/get-started/setting-up-cloud-accounts/">Setting up Your Cloud Accounts</a>.</li>
  <li>The Azure CLI. Follow the <a href="https://learn.microsoft.com/cli/azure/install-azure-cli">Azure documentation</a> for installing or updating the latest version of the Azure CLI.</li>
  <li>An Azure user with sufficient permissions to configure Azure Monitor Logs.</li>
  <li>The GDK CLI. See <a href="/gdk/get-started/setting-up-desktop/">Setting up Your Desktop</a>. (Optional.)</li>
</ul>

<p>Follow the steps below to create the application from scratch. However, you can also download the completed example:</p>

<div id="tabs-doc1">
  <ul>
    <li class="tabs-gradle"><a name="gradle" href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a name="maven" href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <p><a href="https://github.com/oracle/graal-dev-kit/releases/download/4.6.0.3/4.6.0.3_logging_azure-logging-demo-java-gradle.zip">Gradle Azure Logging Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
  <div id="maven">
    <p><a href="https://github.com/oracle/graal-dev-kit/releases/download/4.6.0.3/4.6.0.3_logging_azure-logging-demo-java-maven.zip">Maven Azure Logging Example <img class="download-img-guides" src="/gdk/resources/img/gdk_modules/download-archive.png" alt="Download completed example" /></a>
    </p>
  </div>
</div>
    
      <h4 id="a-note-regarding-your-development-environment">
        
        
          A note regarding your development environment
        
        
      </h4>

<p>Consider using Visual Studio Code, which provides native support for developing applications with the <a href="/gdk/vscode-tools/using-gdk-vscode-tools/">Graal Development Kit extension</a>.</p>

<p>If you use IntelliJ IDEA, <a href="/gdk/resources/img/annotationprocessorsintellij.png">enable annotation processing</a>.</p>

<blockquote>
  <p>Windows platform: The GDK guides are compatible with Gradle only. Maven support is coming soon.</p>
</blockquote>
    
      <h2 id="1-create-the-application">
        
        
          1. Create the Application <a href="#1-create-the-application" class="anchor_heading">#</a>
        
        
      </h2>

<p>Create an application using the GDK Launcher.</p>

<ol>
  <li>
    <p>Open the <a href="/gdk/launcher/?advanced=true">GDK Launcher in advanced mode</a>.</p>
  </li>
  <li>Create a new project using the following selections.
    <ul>
      <li><strong>Project Type</strong>: <em>Application</em> (Default)</li>
      <li><strong>Project Name</strong>: <em>azure-logging-demo</em></li>
      <li><strong>Base Package</strong>: <em>com.example</em> (Default)</li>
      <li><strong>Clouds</strong>: <em>Azure</em></li>
      <li><strong>Build Tool</strong>: <em>Gradle (Groovy)</em> or <em>Maven</em></li>
      <li><strong>Language</strong>: <em>Java</em> (Default)</li>
      <li><strong>Test Framework</strong>: <em>JUnit</em> (Default)</li>
      <li><strong>Java Version</strong>: <em>17</em> (Default)</li>
      <li><strong>Micronaut Version</strong>: (Default)</li>
      <li><strong>Cloud Services</strong>: <em>Logging</em></li>
      <li><strong>Features</strong>: <em>GraalVM Native Image</em> (Default)</li>
      <li><strong>Sample Code</strong>: <em>Yes</em> (Default)</li>
    </ul>
  </li>
  <li>Click <strong>Generate Project</strong>, then click <strong>Download Zip</strong>. The GDK Launcher creates an application with the default package <code>com.example</code> in a directory named <em>azure-logging-demo</em>. The application ZIP file will be downloaded to your default downloads directory. Unzip it, open it in your code editor, and proceed to the next steps.</li>
</ol>

<p>Alternatively, use the <a href="/gdk/get-started/using-gdk-cli/">GDK CLI</a> as follows:</p>

<div id="tabs-doc2">
  <ul>
    <li class="tabs-gradle"><a href="#gradle">Gradle</a></li>
    <li class="tabs-maven"><a href="#maven">Maven</a></li>
  </ul>
  <div id="gradle">
    <pre><code class="language-bash">gdk create-app com.example.azure-logging-demo \
    --clouds=azure \
    --services=logging \
    --features=graalvm \
    --build=gradle \
    --jdk=17 \
    --lang=java</code></pre>
  </div>
  <div id="maven">
    <pre><code class="language-bash">gdk create-app com.example.azure-logging-demo \
    --clouds=azure \
    --services=logging \
    --features=graalvm \
    --build=maven \
    --jdk=17 \
    --lang=java</code></pre>
  </div>
</div>

<p>The GDK Launcher creates a multi-module project with two subprojects: <strong>azure</strong> for Microsoft Azure, and <strong>lib</strong>.
You develop the application logic in the <strong>azure</strong> subproject. If your application is to be deployed to multiple cloud providers, use the <strong>lib</strong> subproject to create classes that can be shared between the providers. This enables you to separate the code that is different between cloud providers, while keeping most of the implementation in the common <strong>lib</strong> subproject.</p>

<p>The Micronaut Logging service that you selected at the project generation step bundles Logback, Jackson Databind, Azure Logging, and other necessary dependencies.
The <a href="https://logback.qos.ch/">Logback</a> appender publishes logs to Azure Monitor Logs.</p>
    
      <h3 id="11-controller-class">
        
        
          1.1. Controller Class <a href="#11-controller-class" class="anchor_heading">#</a>
        
        
      </h3>

<p>The example code includes a controller in a file named <em>azure/src/main/java/com/example/LogController.java</em>, which enables you to send <code>POST</code> requests to publish a message to a log:</p>

<pre><code class="language-java">package com.example;

import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Controller
class LogController {

    private static final Logger LOG = LoggerFactory.getLogger(LogController.class);

    @Post("/log")
    void log(@Body String message) {
        LOG.info(message);
    }
}
</code></pre>
    
      <h2 id="2-create-azure-cloud-resources">
        
        
          2. Create Azure Cloud Resources <a href="#2-create-azure-cloud-resources" class="anchor_heading">#</a>
        
        
      </h2>

<p>You will create a resource group, a Log Analytics Workspace and a table in the workspace to hold log event data, a Data Collection Endpoint, and a Data Collection Rule.</p>
    
      <h3 id="21-create-a-resource-group">
        
        
          2.1. Create a Resource Group <a href="#21-create-a-resource-group" class="anchor_heading">#</a>
        
        
      </h3>

<p>We recommend that you create a new <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/overview#resource-groups">resource group</a> for this guide, but you can use an existing resource group instead.</p>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-create">az group create</a> command to create a resource group named <em>gdkguides</em> in the <em>eastus</em> region:</p>

<pre><code class="language-bash">az group create --location eastus --name gdkguides
</code></pre>

<p>If you prefer using the region geographically closer to you, run <code>az account list-locations</code> to list all available regions.</p>
    
      <h3 id="22-add-the-monitor-control-service-cli-extension">
        
        
          2.2. Add the monitor-control-service CLI Extension <a href="#22-add-the-monitor-control-service-cli-extension" class="anchor_heading">#</a>
        
        
      </h3>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/extension?view=azure-cli-latest#az-extension-add">az extension add</a> command to add the <em>monitor-control-service</em> CLI Extension:</p>

<pre><code class="language-bash">az extension add --name monitor-control-service
</code></pre>
    
      <h3 id="23-add-the-log-analytics-cli-extension">
        
        
          2.3. Add the log-analytics CLI Extension <a href="#23-add-the-log-analytics-cli-extension" class="anchor_heading">#</a>
        
        
      </h3>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/extension?view=azure-cli-latest#az-extension-add">az extension add</a> command to add the <em>log-analytics</em> CLI Extension:</p>

<pre><code class="language-bash">az extension add --name log-analytics
</code></pre>
    
      <h3 id="24-create-a-log-analytics-workspace">
        
        
          2.4. Create a Log Analytics Workspace <a href="#24-create-a-log-analytics-workspace" class="anchor_heading">#</a>
        
        
      </h3>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/monitor/log-analytics/workspace?view=azure-cli-latest#az-monitor-log-analytics-workspace-create">az monitor log-analytics workspace create</a> command to create a Log Analytics Workspace:</p>

<pre><code class="language-bash">az monitor log-analytics workspace create \
   --name gdkworkspace \
   --resource-group gdkguides
</code></pre>

<p>The response should look like this:</p>
<pre><code class="language-json">{
  "createdDate": "2024-08-19T20:11:18.4002398Z",
  "customerId": "c222d080-5b14-43e7-b648-71c2b358dc74",
  ...
  "name": "gdkworkspace",
  "provisioningState": "Creating",
   ...
}
</code></pre>

<p>Save the value of the <em>customerId</em> attribute. This is your workspace GUID, and it will be needed later.</p>
    
      <h3 id="25-create-a-data-collection-endpoint">
        
        
          2.5. Create a Data Collection Endpoint <a href="#25-create-a-data-collection-endpoint" class="anchor_heading">#</a>
        
        
      </h3>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/monitor/data-collection/endpoint?view=azure-cli-latest#az-monitor-data-collection-endpoint-create">az monitor data-collection endpoint create</a> command to create a Data Collection Endpoint:</p>

<pre><code class="language-bash">az monitor data-collection endpoint create \
   --data-collection-endpoint-name gdkCollectionEndpoint \
   --public-network-access Enabled \
   --resource-group gdkguides
</code></pre>

<p>The response should look like this:</p>
<pre><code class="language-json">{
  ...
  "logsIngestion": {
    "endpoint": "https://gdkcollectionendpoint-xxxx.eastus-1.ingest.monitor.azure.com"
  },
  ...
  "name": "gdkCollectionEndpoint",
  ...
  "type": "Microsoft.Insights/dataCollectionEndpoints"
}
</code></pre>

<p>Save the value of the <em>logsIngestion.endpoint</em> attribute. This is the logs ingestion endpoint URL, and it will be needed later.</p>
    
      <h3 id="26-create-a-table-in-your-log-analytics-workspace">
        
        
          2.6. Create a Table in Your Log Analytics Workspace <a href="#26-create-a-table-in-your-log-analytics-workspace" class="anchor_heading">#</a>
        
        
      </h3>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/monitor/log-analytics/workspace/table?view=azure-cli-latest#az-monitor-log-analytics-workspace-table-create">az monitor log-analytics workspace table create</a> command to create a table in your Log Analytics workspace to hold the log records:</p>

<pre><code class="language-bash">az monitor log-analytics workspace table create \
   --name GDKTable_CL \
   --workspace-name gdkworkspace \
   --columns EventTimestamp=long Source=string Subject=string Data=string TimeGenerated=datetime \
   --resource-group gdkguides
</code></pre>
    
      <h3 id="27-create-a-data-collection-rule">
        
        
          2.7. Create a Data Collection Rule <a href="#27-create-a-data-collection-rule" class="anchor_heading">#</a>
        
        
      </h3>

<p>Create a file named <em>dcr.json</em> with this content:</p>

<pre><code class="language-json">{
  "location": "&lt;region&gt;",
  "properties": {
    "streamDeclarations": {
      "Custom-GDKTable": {
        "columns": [
          {
            "name": "TimeGenerated",
            "type": "datetime"
          },
          {
            "name": "EventTimestamp",
            "type": "long"
          },
          {
            "name": "Source",
            "type": "string"
          },
          {
            "name": "Subject",
            "type": "string"
          },
          {
            "name": "Data",
            "type": "string"
          }
        ]
      }
    },
    "destinations": {
      "logAnalytics": [
        {
          "workspaceResourceId": "/subscriptions/&lt;subscription-id&gt;/resourceGroups/gdkguides/providers/microsoft.operationalinsights/workspaces/gdkworkspace",
          "name": "gdkLogDestination"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Custom-GDKTable"
        ],
        "destinations": [
          "gdkLogDestination"
        ],
        "transformKql": "source | extend TimeGenerated = now()",
        "outputStream": "Custom-GDKTable_CL"
      }
    ]
  }
}
</code></pre>

<p>Replace &lt;region&gt; with the name of the region you are using, for example, “eastus”, and replace &lt;subscription-id&gt; with your Azure Subscription ID.</p>

<p>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/monitor/data-collection/rule?view=azure-cli-latest#az-monitor-data-collection-rule-create">az monitor data-collection rule create</a> command to create a data collection rule:</p>

<pre><code class="language-bash">az monitor data-collection rule create \
   --name gdkCollectionRule \
   --location &lt;region&gt; \
   --endpoint-id /subscriptions/&lt;subscription-id&gt;/resourceGroups/gdkguides/providers/Microsoft.Insights/dataCollectionEndpoints/gdkCollectionEndpoint \
   --rule-file "path/to/dcr.json" \
   --resource-group gdkguides
</code></pre>

<p>Replace &lt;region&gt; with the name of the region you are using, for example, “eastus”, replace &lt;subscription-id&gt; with your Azure Subscription ID, and replace “path/to/dcr.json” with the file location of the file you created.</p>

<p>The response should look like this:</p>
<pre><code class="language-json">{
  "dataCollectionEndpointId": "/subscriptions/fe053...",
  "dataFlows": [
    {
      "destinations": [
        "gdkLogDestination"
      ],
      "outputStream": "Custom-GDKTable_CL",
      "streams": [
        "Custom-GDKTable"
      ],
      "transformKql": "source | extend TimeGenerated = now()"
    }
  ],
  ...
  "immutableId": "dcr-e7ebfceb7df24631b64d7ae880eb8ada",
  "location": "eastus",
  "name": "gdkCollectionRule",
  ...
  "type": "Microsoft.Insights/dataCollectionRules"
}
</code></pre>

<p>Save the value of the <em>immutableId</em> attribute. This is the rule ID, and it will be needed later.</p>
    
      <h3 id="28-authorize-sending-logs">
        
        
          2.8. Authorize Sending Logs <a href="#28-authorize-sending-logs" class="anchor_heading">#</a>
        
        
      </h3>

<p>Authorize sending logs by assigning the <em>Monitoring Metrics Publisher</em> role to yourself:</p>

<pre><code class="language-bash">az role assignment create \
   --role "Monitoring Metrics Publisher" \
   --assignee &lt;email&gt; \
   --scope "/subscriptions/&lt;subscription-id&gt;/resourceGroups/gdkguides/providers/Microsoft.Insights/dataCollectionRules/gdkCollectionRule"
</code></pre>
<p>replacing <em>&lt;email&gt;</em> with the email address associated with your account, and <em>&lt;subscription-id&gt;</em> with your Azure Subscription ID.</p>

<p>Note that it can take a few minutes for the role grant to propagate.</p>
    
      <h2 id="3-configure-appender-and-application-configuration">
        
        
          3. Configure Appender and Application Configuration <a href="#3-configure-appender-and-application-configuration" class="anchor_heading">#</a>
        
        
      </h2>
    
      <h3 id="31-logback-appender">
        
        
          3.1. Logback Appender <a href="#31-logback-appender" class="anchor_heading">#</a>
        
        
      </h3>

<p>The GDK Launcher generated a file named <em>azure/src/main/resources/logback.xml</em> containing the configuration for an appender that publishes log events to Azure Monitor Logs:</p>

<pre><code class="language-xml">&lt;configuration debug='false'&gt;

    &lt;!--
    You can un-comment the STDOUT appender and &lt;appender-ref ref='STDOUT'/&gt; in
    the cloud appender to log to STDOUT as the 'emergency' appender.
    --&gt;

    &lt;!--
    &lt;appender name='STDOUT' class='ch.qos.logback.core.ConsoleAppender'&gt;
        &lt;encoder&gt;
            &lt;pattern&gt;%cyan(%d{HH:mm:ss.SSS}) %gray([%thread]) %highlight(%-5level) %magenta(%logger{36}) - %msg%n&lt;/pattern&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;
    --&gt;

    &lt;appender name='AZURE' class='io.micronaut.azure.logging.AzureAppender'&gt;
        &lt;!-- &lt;appender-ref ref='STDOUT'/&gt; --&gt;
        &lt;encoder class='ch.qos.logback.core.encoder.LayoutWrappingEncoder'&gt;
            &lt;layout class='ch.qos.logback.contrib.json.classic.JsonLayout'&gt;
                &lt;jsonFormatter class='io.micronaut.azure.logging.AzureJsonFormatter'/&gt;
            &lt;/layout&gt;
        &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;root level='INFO'&gt;
        &lt;appender-ref ref='AZURE'/&gt;
    &lt;/root&gt;

&lt;/configuration&gt;
</code></pre>

<blockquote>
  <p>Note: You can un-comment the STDOUT appender as the ‘emergency’ appender. See the file for details.</p>
</blockquote>
    
      <h3 id="32-set-application-configuration-properties">
        
        
          3.2. Set Application Configuration Properties <a href="#32-set-application-configuration-properties" class="anchor_heading">#</a>
        
        
      </h3>

<p>Update the Azure <em>application.properties</em> as follows:</p>

<p><em>azure/src/main/resources/application.properties</em></p>
<pre><code># &lt;1&gt;
azure.logging.data-collection-endpoint=&lt;endpoint&gt;
# &lt;2&gt;
azure.logging.rule-id=&lt;ruleid&gt;
# &lt;3&gt;
azure.logging.stream-name=Custom-GDKTable
</code></pre>

<p><strong>1</strong> Replace &lt;endpoint&gt; with the logs ingestion endpoint URL that you saved earlier</p>

<p><strong>2</strong> Replace &lt;ruleid&gt; with the rule ID that you saved earlier</p>

<p><strong>3</strong> Set the value of the <em>azure.logging.stream-name</em> property with the name of the workspace table you created, “Custom-GDKTable”</p>

<p>Having configured the appender and the application configuration, you can proceed to run the application, publishing the logs.</p>
    
      <h2 id="4-run-the-application-publish-and-view-logs">
        
        
          4. Run the Application, Publish and View Logs <a href="#4-run-the-application-publish-and-view-logs" class="anchor_heading">#</a>
        
        
      </h2>

<ol>
  <li>
    <p>Run the application using the following command (it will start the application on port 8080):</p>

    <div id="tabs-doc3">
 <ul>
     <li class="tabs-gradle"><a href="#gradle">Gradle</a></li>
     <li class="tabs-maven"><a href="#maven">Maven</a></li>
 </ul>
 <div id="gradle">
     <pre><code class="language-bash">./gradlew :azure:run</code></pre>
 </div>
 <div id="maven">
     <pre><code class="language-bash">./mvnw install -pl lib -am
./mvnw mn:run -pl azure</code></pre>
 </div>
 </div>
  </li>
  <li>Send some <code>curl</code> requests to test logging:
    <pre><code class="language-bash"> curl -id '{"message":"your message here"}' \
      -H "Content-Type: application/json" \
      -X POST http://localhost:8080/log
</code></pre>
  </li>
  <li>Run the <a href="https://learn.microsoft.com/en-us/cli/azure/monitor/log-analytics?view=azure-cli-latest#az-monitor-log-analytics-query">az monitor log-analytics query</a> command to retrieve log events that were pushed while running your application:
    <pre><code class="language-bash"> az monitor log-analytics query \
    --workspace &lt;workspace-guid&gt; \
    --analytics-query "GDKTable_CL | where TimeGenerated &gt; ago(1h)"
</code></pre>
  </li>
</ol>

<p>Replace &lt;workspace-guid&gt; with the workspace GUID that you saved earlier.</p>

<p>Note that it can take a few minutes for log entries be available.</p>
    
      <h2 id="5-clean-up-cloud-resources">
        
        
          5. Clean up Cloud Resources <a href="#5-clean-up-cloud-resources" class="anchor_heading">#</a>
        
        
      </h2>

<p>Once you are done with this guide, you can delete the Azure resources created to avoid incurring unnecessary charges.</p>

<p>Delete the resource group and all of its resources with:</p>
<pre><code class="language-bash">az group delete --name gdkguides
</code></pre>

<p>Alternatively, run these commands to delete resources individually:</p>

<pre><code class="language-bash">az monitor data-collection rule delete --name gdkCollectionRule --resource-group gdkguides
</code></pre>

<pre><code class="language-bash">az monitor log-analytics workspace table delete --name GDKTable_CL --workspace-name gdkworkspace --resource-group gdkguides
</code></pre>

<pre><code class="language-bash">az monitor data-collection endpoint delete --name gdkCollectionEndpoint --resource-group gdkguides
</code></pre>

<pre><code class="language-bash">az monitor log-analytics workspace delete --workspace-name gdkworkspace --resource-group gdkguides --force
</code></pre>

<pre><code class="language-bash">az group delete --name gdkguides
</code></pre>
    
      <h3 id="summary">
        
        
          Summary <a href="#summary" class="anchor_heading">#</a>
        
        
      </h3>

<p>This guide demonstrated how to use the GDK to create an application that publishes logs to Azure Monitor Logs.
Then, using Azure Monitor Logs, you viewed the logs produced by the application.
Finally, you saw how to build a native executable for this application with GraalVM Native Image, and ran it to test publishing logs to Azure Monitor Logs.</p>
    
      <h3 id="related-documentation">
        
        
          Related Documentation <a href="#related-documentation" class="anchor_heading">#</a>
        
        
      </h3>

<ul>
  <li><a href="https://micronaut-projects.github.io/micronaut-azure/latest/guide/#logging" target="_blank">Micronaut Azure Logging</a></li>
  <li><a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/data-platform-logs" target="_blank">Azure Monitor Logs</a></li>
  <li><a href="https://www.graalvm.org/" target="_blank">GraalVM Native Image</a></li>
</ul>

      </div>

      <div role="button" class="menu-btn menu-btn--sidebar js-show-sidebar" title="sweet hamburger">
        <div class="hamburger">
          <div class="inner"></div>
        </div>
      </div>
    </div>
  </div>
</article>



</div>

      </main>

      
<footer class="footer footer__mobile">

  <div class="container-fluid container-fluid--custom-sm">
    <div class="row">
      <div class="col-12 col-sm-12 col-md-12 col-lg-12">
        <div class="row footer-content">
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">Learn</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/get-started/">Get Started</a></li>
                <li class="footer-list__item"><a href="/gdk/guides/">Guides</a></li>
                <li class="footer-list__item"><a href="/gdk/hands-on-labs/">Labs</a></li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/logo-github.svg" alt="Github icon">
                  <a href="https://github.com/oracle/graal-dev-kit" target="blank">Github</a>
                </li>
                <li class="footer-list__github">
                  <img class="footer__icon" src="/gdk/resources/img/footer/slack-icon.svg" alt="Github icon">
                  <a href="https://bit.ly/odevrel_slack" target="blank">#graal-dev-kit-for-micronaut</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-md-3 col-sm-4">
            <h6 class="title-footer" onclick="fadeInAndOut(this)">About</h6>
            <div class="grow">
              <ul class="footer-list">
                <li class="footer-list__item"><a href="/gdk/about/#gdk-support" target="blank">Commercial Support</a></li>
                <li class="footer-list__item"><a href="https://www.graalvm.org/" target="blank">GraalVM Native Image</a></li>
                <li class="footer-list__item"><a href="https://micronaut.io/" target="_blank">Micronaut<sup>&reg;</sup> Framework</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/multicloud/what-is-multicloud/" target="_blank">Multicloud</a></li>
                <li class="footer-list__item"><a href="https://www.oracle.com/cloud/" target="blank">Oracle Cloud Infrastructure</a></li>
                <li class="footer-list__item"><a href="https://marketplace.visualstudio.com/items?itemName=oracle-labs-graalvm.graal-cloud-native-pack" target="blank">VS Code Tools</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md-6 col-sm-12 aligning_1024">
            <div class="card--footer card--hovered box">
              <div>
                <div class="rubber-footer footer__oci-section">
                  <p class="title-footer quickstart">Build, test, and deploy applications on Oracle Cloud Infrastructure for free</p>
                  <a href="https://www.oracle.com/cloud/free/" target="_blank"
                    class="btn btn-primary">Try Oracle Cloud Infrastructure Free Tier</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
          <div class="row">
            <div class="col-sm-12">
              <p class="copyright">
                Copyright &copy; 2023-2024, Oracle and/or its affiliates.
                All rights reserved.
                Oracle and Java are registered trademarks of Oracle and/or its affiliates.<br/>
                Micronaut<sup>&reg;</sup> is a registered trademark of Object Computing, Inc.
                Use is for referential purposes and does not imply any endorsement or affiliation with any third-party product.
                Unauthorized use is strictly prohibited. Other names may be trademarks of their respective owners.
              </p>
              <div id="teconsent"></div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</footer>

<script>
  function fadeInAndOut(thz) {
    var elmt = thz.nextElementSibling;//Get the element that is below the button that
    //was just clicked
    if (elmt.clientHeight) {
      elmt.style.height = 0;
    } else {
      var wrapper = elmt.querySelector('ul');
      elmt.style.height = wrapper.clientHeight + "px";
    }
    /*
        elmt.classList.toggle("acordianPanelHidden");//Toggle the class which changes
        //attributes which triggers the transition CSS
        */
  }

  // Check TRUSTe Consent for Functional or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(2) != -1) ) {

      //The following is a sample of a Maxymiser Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript" src="//service.maxymiser.net/cdn/oracle/js/mmcore.js"><\/script>');
  }

  // Check TRUSTe Consent for Advertising or Implied Approval
  // The if test verifies if the user has given the consent
  if ( (oracle.truste.api.getGdprConsentDecision().consentDecision) &&
      (oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(0) != -1 ||
        oracle.truste.api.getGdprConsentDecision().consentDecision.indexOf(3) != -1) ) {

      //The following is a sample of a BlueKai Core Tag being written to the DOM
      //If the user did not give consent, then the tag is not included and not invoked in the Browser
      document.write('<script type="text/javascript">' +
      'window.bk_async = function() { ' +
      'BKTAG.doTag(62581, 1); }; ' +
      '(function() { ' +
      'var scripts = document.getElementsByTagName(\'script\')[0]; ' +
      'var s = document.createElement(\'script\'); ' +
      's.async = true; ' +
      's.src = "https://tags.bkrtx.com/js/bk-coretag.js"; ' +
      'scripts.parentNode.insertBefore(s, scripts); ' +
      '}()); ' +
      '<\/script>');
  }
</script>

    </div>
    <div class="overlay"></div>

    <!-- Start SiteCatalyst code -->
    <script language="JavaScript" src="https://www.oracle.com/us/assets/metrics/ora_otn.js"></script>
    <!-- End SiteCatalyst code -->

    <script src='/gdk/resources/lib/slick-slider/slick.min.js'></script>
    <script src='/gdk/resources/js/main.js'></script>
    <script src='/gdk/resources/js/ui.js'></script>
    <script src='/gdk/resources/js/filters.js'></script>
    <script src='/gdk/resources/js/sidebar.js'></script>
    <script src='/gdk/resources/js/labs.js'></script>
    <script src='/gdk/resources/lib/highlight/highlight.min.js'></script>
    <script>hljs.highlightAll();</script>
  </body>
</html>
